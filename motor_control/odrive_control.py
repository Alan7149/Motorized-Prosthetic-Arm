from __future__ import print_function

import argparse
import os
import time
import math
import matplotlib.pyplot as plt

from pid import PID

import odrive
from odrive.utils import start_liveplotter
from odrive.enums import *

STRAIGHT_POSITION = 0.55


def liveplot(driver_name):
    start_liveplotter(lambda: [
        driver_name.axis0.encoder.pos_estimate,
        driver_name.axis0.encoder.vel_estimate,
        driver_name.axis0.motor.current_control.Iq_measured
    ])


def clear_errors(driver_name):
    if driver_name.axis0.error:
        print("axis 0", driver_name.axis0.error)
        driver_name.axis0.error = 0

    if driver_name.axis0.motor.error:
        print("motor 0", driver_name.axis0.motor.error)
        driver_name.axis0.motor.error = 0

    if driver_name.axis0.encoder.error:
        print("encoder 0", driver_name.axis0.encoder.error)
        driver_name.axis0.encoder.error = 0


def Calibration(driver_name):
    # Calibrate motor and wait for it to finish
    print("Starting calibration...")
    driver_name.axis0.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE
    while driver_name.axis0.current_state != AXIS_STATE_IDLE:
        time.sleep(0.1)


def shut_down(driver_name):
    # Stopping the motor spin
    driver_name.axis0.controller.config.control_mode = CONTROL_MODE_VELOCITY_CONTROL
    driver_name.axis0.controller.input_vel = 0

    # Moving to straight position
    driver_name.axis0.controller.config.control_mode = CONTROL_MODE_POSITION_CONTROL
    driver_name.axis0.controller.input_pos = STRAIGHT_POSITION
    print("Going back to home position")


def get_motor_state(driver_name):
    motor_pos = driver_name.axis0.encoder.pos_estimate
    motor_vel = driver_name.axis0.encoder.vel_estimate
    motor_current = driver_name.axis0.motor.current_control.Iq_setpoint

    return motor_pos, motor_vel, motor_current


def position_control(driver_name, use_double_pendulum):
    driver_name.axis0.controller.config.control_mode = CONTROL_MODE_POSITION_CONTROL

    # elbow_pos = [0.005925820100464046, 0.014852683626604359, 0.02348634739005773, 0.03181871112786842, 0.039920126698027386, 0.04774276649285528, 0.05543076329440357, 0.06299824053601163, 0.07041017593390624, 0.07765293674623631, 0.08462510788806167, 0.0911577771023147, 0.09703816086554401, 0.10198122834634304, 0.10579336450311974, 0.1083031838167719, 0.10939589431353343, 0.10907590291985522, 0.10743953927841893, 0.10473030968455616, 0.10092250078826145, 0.09622658622490984, 0.09038562047139999, 0.08341250837536941, 0.07519438532857668, 0.06565298177025951, 0.05468600814014867, 0.04234377078671607, 0.028584384811058215, 0.013672666515108773, -0.002497515693605707, -0.019780470309631405, -0.03823488991534532, -0.05761743992964628, -0.07799252712484135, -0.09907451758716933, -0.12089413480495156, -0.14338248564302603, -0.166578510876974, -0.19040040544448675, -0.2149312311220724, -0.2399336493328082, -0.2653504199187806, -0.29090848888132387, -0.316444468526884, -0.34181278919708025, -0.36695752006987425, -0.3916751826208477, -0.4159800689943208, -0.439737671770135, -0.4630568964002658, -0.48582442110607155, -0.5080951720641282, -0.5296943560000482, -0.5507526542614278, -0.5711204207394385, -0.5907599120755731, -0.6094200097779193, -0.6271073556780494, -0.6435912979295415, -0.6589483264106694, -0.6731129454575573, -0.685867375589024, -0.6972581920573326, -0.7073930607613697, -0.7161717742913455, -0.7236413535463075, -0.7295663061884446, -0.7340131991786996, -0.7368880899814366, -0.7381348756744861, -0.7376508904781689, -0.7354479902535417, -0.7315634045680187, -0.7261078547619811, -0.7190462204771763, -0.7105289877256523, -0.7005104400061819, -0.6887778178307575, -0.6750918623579035, -0.6593054063312509, -0.6416695243902386, -0.6224436475341361, -0.6019953726464389, -0.5804350838394632, -0.5583154751238167, -0.5358202952004751, -0.5132865168733732, -0.4907514533728258, -0.4684296866410268, -0.44633247606826665, -0.4246027121937973, -0.4031534637419132, -0.38198898886995203, -0.36100623670603543, -0.3402615891719262, -0.3197685456726844, -0.29971881968177155, -0.2800476350415523, -0.2610152632644866, -0.2425281879141517, -0.22475007087855867, -0.20765707044949086, -0.19122670676068024, -0.1753166800634316, -0.16003005030396955, -0.14546936614725361, -0.13179109793959312, -0.11897966648918462, -0.10712993881163536, -0.09607014464329085, -0.08582339730929767, -0.0762241687751945, -0.06741412637820046, -0.059357224534424415, -0.05204396776491161, -0.04538737372087026, -0.03923452597663366, -0.033420572353695346, -0.02785061721558267, -0.022353484585659604, -0.01692533074968748, -0.011357675373400192, -0.005728983122944844, 3.6437168617001096e-05, 0.0058845710401858944, 0.011823816944892833, 0.017699426444563016, 0.02353679840884375, 0.029352218806339314, 0.03506757354304906, 0.04074698641051351, 0.046206649942096945, 0.05134132709958676, 0.05608214173308792, 0.06036077521143135, 0.06403521228988067, 0.06707136705714878, 0.06925159863712552, 0.07074880985688697, 0.0713099183261578, 0.07090500235768228, 0.06922417318325383, 0.06612194732167939, 0.06133123779668157, 0.05488965515761224, 0.04656009017854263, 0.03653625872943077, 0.02461870975760448, 0.01106100177535323, -0.004257060190579499, -0.02111326335972508, -0.03949510574284581, -0.05928722378362298, -0.08074134590845848, -0.10342071546814281, -0.12709981067439108, -0.15151514367894403, -0.17682247158135156, -0.20291259658265923, -0.22975562833232108, -0.2569190810336913, -0.2842589495010588, -0.3114371808215051, -0.33860595238451807, -0.3655339333983061, -0.3923525028872077, -0.4187943868144529, -0.44475943419788827, -0.46990860485985364, -0.494195016395021, -0.5172747296260185, -0.5392866104733653, -0.5600443062756504, -0.5797369251089777, -0.5983667858884895, -0.6159937495933833, -0.6324964735288924, -0.6478935001365481, -0.6619767905885376, -0.6749412532760258, -0.6868517541498345, -0.697758127993247, -0.707657671566683, -0.7166068628154507, -0.724428977435307, -0.7309913744791493, -0.7361951534534411, -0.7401270553596675, -0.742885740879792, -0.7444854030540962, -0.7448848373789299, -0.74400122195364, -0.7417424960450131, -0.738043746057492, -0.7329795952076997, -0.7265037286307096, -0.718608074598477, -0.709409937719482, -0.6988875923857963, -0.6867712736874272, -0.6727325004402734, -0.6566576744533807, -0.6388218199771881, -0.6195687877422833, -0.5992684847826671, -0.5781038688457826, -0.5564811376121628, -0.5346201464578176, -0.5128470488141816, -0.4912031437320126, -0.46994889097733594, -0.44896383836366516, -0.42841755515673235, -0.40801022122403546, -0.3877378909247729, -0.36748069847830833, -0.3473479254228974, -0.32723510935329364, -0.30730544671027615, -0.28758498343102834, -0.26832502721790985, -0.24944985594902822, -0.23104381187556544, -0.21299347895482276, -0.19543525237667944, -0.1783443105644233, -0.16185520781466106, -0.14611468319462562, -0.13132618559956233, -0.11746343696945824, -0.1045330498627554, -0.09239781724526605, -0.08105062806313491, -0.07034781879091227, -0.060263127328964106, -0.050612639135348636, -0.041543574650380916, -0.03288757003151533, -0.024670689724815526, -0.016809481769137324, -0.009286587711249935, -0.0020201152656223543, 0.0050323187819682254, 0.01185183981112262, 0.018482459971393007, 0.02496946721457776, 0.03135792020119694, 0.03770860259661256, 0.04402426535377819, 0.05036434303892894, 0.05670811115021186, 0.06300905836645276, 0.06926701435073307, 0.07537496462613036, 0.08124437963152559, 0.08671437427270595, 0.09162732571113959, 0.0956940702246895, 0.09876240425248259, 0.10051628703592123, 0.10099073483102765, 0.10009002639802193, 0.09799114355527067, 0.09467122066249953, 0.09003814356688435, 0.08385089592501496, 0.0762062132710803, 0.06684596336912346, 0.055888537084632824, 0.04325098507053559, 0.028992752906574232, 0.013026864001619641, -0.004416832769319495, -0.023332881360186648, -0.04352982972333769, -0.06487199280084134, -0.08712435516549272, -0.11006657179231485, -0.13339417052518376, -0.15707489049747833, -0.18094695528305837, -0.20511554356257622, -0.22947936206384617, -0.2539719043249399, -0.2784932654557999, -0.30302881702722567, -0.3275318948042434, -0.3520085460566473, -0.3761709514636025, -0.3999923818224469, -0.4233633401656015, -0.4462550490426631, -0.4685067055506569, -0.49004973637699917, -0.5107177660370006, -0.5305331583334418, -0.5494216495922892, -0.5676032039550779, -0.5849104031715541, -0.6014007086379376, -0.6169042822061908, -0.6314658308542654, -0.6449868831145803, -0.6573803760777149, -0.6686380100765764, -0.6788105674562855, -0.6879558552890259, -0.6960350750511958, -0.7029520545016806, -0.7086479738567962, -0.7129702932451809, -0.7158665565689504, -0.7171700432849766, -0.7170442721105573, -0.7156724888917351, -0.7130006390264435, -0.7090479910267623, -0.7037957752024202, -0.697202639190361, -0.6892248022773836, -0.6798410471202974, -0.6691638311819957, -0.6571412843712665, -0.6437353579701338, -0.6289856543577129, -0.6129478523474413, -0.5958711169235479, -0.5778717550252882, -0.5590847286864293, -0.5396313583948397, -0.5198190485408596, -0.4999719399696726, -0.4803953990348842, -0.46131556644745036, -0.4428734840622818, -0.42494222654254776, -0.4073862605646367, -0.38992265079107247, -0.37242477852734945, -0.35488093931130893, -0.337367326782436, -0.3198826278760326, -0.30252677214331103, -0.2852298275961859, -0.26802622889888694, -0.25080661924673286, -0.23364479361050405, -0.21641041791963467, -0.19925720425241195, -0.18216143282493558, -0.16540825430767636, -0.14907078429690448, -0.13335154014612283, -0.1182682213516142, -0.10396096128716086, -0.09038085366462642, -0.07754869925188597, -0.06528630039545474, -0.05366373176868366, -0.04254459888942332, -0.031998185421184315, -0.021937507865237214, -0.01243538065024527, -0.003403502858669078, 0.00506655526568347, 0.013217137833313604, 0.021087755056545504, 0.02885735074663501, 0.0365550514152696, 0.044193612085596454, 0.05176603969759233, 0.059201475381105935, 0.06647234738315437, 0.07349640407260725, 0.08018015909344894, 0.08646964165239295, 0.09223955424060928, 0.09744264229135571, 0.10203323501280843, 0.10585872740498391, 0.10890026963305591, 0.11092318771204934, 0.11175362852456111, 0.11117433905883173, 0.10920298622164615, 0.10594667060687263, 0.10167146702445107, 0.09634778062865564, 0.09005201071078481, 0.08256917212684778, 0.07386276978453248, 0.06368972958484506, 0.05201952897975494, 0.03878740079980793, 0.02405829701427609, 0.007727974607368529, -0.010049404825810926, -0.029285936266742457, -0.049773971561526964, -0.07149685806378558, -0.09416495930660809, -0.11763529603014572, -0.14155546096252908, -0.1659005541161613, -0.19055376584283906, -0.21548354630463487, -0.24043037344239634, -0.2653238923218899, -0.2899576919779382, -0.31443818644360444, -0.3386029696567269, -0.36248525419045013, -0.38590693323612835, -0.4087091332647412, -0.43067449532173835, -0.4519512062223487, -0.47248467921072945, -0.49236778126972724, -0.5114378472710591, -0.5297806561316531, -0.5473845384079185, -0.5641503803140935, -0.5800129685324369, -0.5949162509517518, -0.608869177918836, -0.6220645391590639, -0.6344785976408388, -0.6461668556278483, -0.6570586266760463, -0.6671266210740728, -0.6762989746757219, -0.6844562629239712, -0.6914110549064092, -0.697034752168283, -0.7012792523840706, -0.7042814069958436, -0.7060505690630238, -0.7066771639565667, -0.7061283035896228, -0.7043864720515073, -0.7013808805770003, -0.6970634648407242, -0.691289933599538, -0.6839909964111045, -
    #              0.6751263863844021, -0.6643887704484512, -0.6515679699114796, -0.6366119848809346, -0.619895157877366, -0.6017894580439441, -0.5826774549797916, -0.5626919621357807, -0.5422861337227612, -0.5215090869738347, -0.5005752356692073, -0.47959025794203697, -0.4587642455658073, -0.43801495552016956, -0.4174766470649355, -0.39684979303252765, -0.3761526311057428, -0.3553409016612657, -0.334646115257564, -0.3140246059445399, -0.2936806216671844, -0.27363713529183986, -0.25401375340424787, -0.2348246131028175, -0.21611457515841295, -0.19782133311447955, -0.1800570663309578, -0.16272428670511854, -0.14600070318943953, -0.12982985130202074, -0.1144222750446507, -0.09966144369583196, -0.08572816075658901, -0.07239419797703867, -0.05972839995521724, -0.04759739627083548, -0.036106072674044545, -0.025140798800255906, -0.014901036999014608, -0.005290250775409408, 0.0036963926303854263, 0.012135181855880795, 0.01999190719909444, 0.02735928208148014, 0.03430071214366144, 0.04090307443975883, 0.04716671389083103, 0.053263352420923185, 0.059062876720828585, 0.06473437752345981, 0.07026110314310234, 0.07567313145053031, 0.08102359063728401, 0.08622486320132829, 0.091230706965803, 0.09600784634882749, 0.10054757359456692, 0.1048964288681847, 0.10902694236886798, 0.11273525948570773, 0.11575847525868659, 0.11778212747016396, 0.11861212463150622, 0.11821226521202048, 0.11653312125141535, 0.11357573706012039, 0.10930445298793473, 0.10363425520139222, 0.09657586217588429, 0.08803774567027794, 0.07801530472076056, 0.06637963930080773, 0.05337098638352248, 0.03888350726390266, 0.023205340244607055, 0.006272979881955096, -0.011684509793754046, -0.030683810320379114, -0.05047569164977149, -0.07106837946130941, -0.0922248601319694, -0.11405665916247294, -0.13636231682674824, -0.15915946974982695, -0.18222744154736642, -0.20561754337639324, -0.22918628715844577, -0.2530156089585351, -0.27681685679032714, -0.3005925427910739, -0.324100466333264, -0.3473644207766882, -0.37019095063479074, -0.39268220917051394, -0.4147081111296272, -0.43627227857676537, -0.4572363857421655, -0.4775887376071248, -0.49718352053202647, -0.5160748162552847, -0.5341174308707449, -0.5512905950632639, -0.5675749391747119, -0.5830052376717018, -0.5976238559289478, -0.6114442697887623, -0.6243659747279147, -0.6364621221762841, -0.6476083233291879, -0.6578572433339757, -0.667161542262706, -0.6754372288911966, -0.682659216286434, -0.6888308017433924, -0.6940147843191026, -0.6982568158371938, -0.701491720674926, -0.7036684626590588, -0.7047682104419731, -0.704741465022711, -0.7036667478502571, -0.7014849695065983, -0.6981681006130775, -0.6936825544408252, -0.6877811277466777, -0.6803495808889136, -0.6715084028487618, -0.6614913144157999, -0.6506756355829734, -0.6391369110215342, -0.6269970697723829, -0.6142864823068861, -0.6011483348238128, -0.5876280133407294, -0.5738745267541024, -0.5599346375572032, -0.5458900888033053, -0.5317216206123621, -0.5174635555147588, -0.502905139532849, -0.48804000842727424, -0.47259418565068917, -0.45667735611112004, -0.44011070059444174, -0.42303371831695985, -0.4053916322104632, -0.3871908902198193, -0.3683743100126833, -0.34907159829372225, -0.32921746503260974, -0.30909176275310535, -0.28875780840923904, -0.2685392606843095, -0.24847234797568957, -0.22877131864347028, -0.20936269665566523, -0.19042463888963404, -0.17186980752484693, -0.15376506802118448, -0.13607470870687294, -0.11901847879667843, -0.1024483879492524, -0.0864766261908163, -0.07101524432974422, -0.05616564278641561, -0.04175933830379548, -0.027934498593774792, -0.014556580960921448, -0.0015684959389104438, 0.01105791864689872, 0.023235937493180748, 0.03504696919167827, 0.0464250898419938, 0.05740475189601965, 0.06804796616417576, 0.07832762116189984, 0.08821052993387357, 0.09780653431326959, 0.10704305535779679, 0.1158864613964167, 0.12423173860217687, 0.13185691558866927, 0.13864015561863682, 0.14430610433847174, 0.1486687465385822, 0.15162421977318538, 0.15315500772465507, 0.1531585671473896, 0.15158041755483773, 0.14834879093080888, 0.14355148572412554, 0.1371742059931127, 0.12915958602127803, 0.11946181479449997, 0.10805257593775755, 0.09482151746975975, 0.07994117062321524, 0.06344614295595873, 0.04562605039686472, 0.02651151911924659, 0.006356644838892101, -0.014798247645904143, -0.03672370641934561, -0.059441883223103294, -0.08271004627102517, -0.10662361832084956, -0.130887825017681, -0.15562677650617623, -0.18056369780885392, -0.20581536904345, -0.2311350362767587, -0.25661824506590747, -0.2820397128542818, -0.3074938833203483, -0.33278347521406687, -0.3578676112299913, -0.3823587338042097, -0.40634678867718715, -0.4297046911236636, -0.45253200575882674, -0.4746933924200911, -0.49629733439390183, -0.5171409438089123, -0.5372823548840846, -0.5564956408616641, -0.5747167575242098, -0.5918161036762439, -0.6077962815359256, -0.6226199606556275, -0.6363864593267121, -0.6490768103720489, -0.6607864161784732, -0.671398389755025, -0.6809003470425434, -0.6891820870469162, -0.6961518714272609, -0.7016599919714693, -0.7057170184201383, -0.7082988033962941, -0.7095300483235862, -0.7094773596723853, -0.7082164956937839, -0.70584696049556, -0.7023998274425709, -0.6978831739855742, -0.6923234233112487, -0.6856652231734528, -0.6776802105914091, -0.6683331569912804, -0.6574506514313829, -0.6451976747629822, -0.6318544612204408, -0.6176608648640541, -0.6026420558945979, -0.5868648866397161, -0.5704076180922095, -0.5533512707917166, -0.5358013747626271, -0.5180015169933997, -0.5000650846093302, -0.48214084250854233, -0.46421127440730797, -0.4463123706986154, -0.42831243912992517, -0.4103753285687735, -0.3923894318596534, -0.37457269260804327, -0.3568203546504032, -0.3392577446141014, -0.32183183200819077, -0.3046776999576593, -0.28775691569464257, -0.2711884383254168, -0.2548071282201532, -0.2387756190974325, -0.22303346859207132, -0.20778987739850233, -0.19305532834223144, -0.17897512841961424, -0.16545690535467864, -0.15255684773168646, -0.14014753382001602, -0.12830228423663306, -0.11690938176033107, -0.10605984303360955, -0.09571130315350429, -0.08587075816182578, -0.0764774903708791, -0.06760231352918411, -0.05898798617563832, -0.05068014188316985, -0.042490612745094705, -0.03452618706664494, -0.026595272551955526, -0.01876996490842261, -0.010897130946773944, -0.0029839749684296073, 0.005045735176979661, 0.013163813597579226, 0.021384936367305298, 0.02960839538435127, 0.037677238410716504, 0.0455069533564994, 0.05298481642437063, 0.06011776739605759, 0.06674348398396542, 0.07287648655939373, 0.07845233911080313, 0.08335987568877294, 0.08739656500899778, 0.09048335139207085, 0.09237843167649795, 0.09310791042774247, 0.09256500387179088, 0.09086637919470471, 0.08800460086483489, 0.08399028066423266, 0.07861941024858196, 0.0718153156990515, 0.0633158927355575, 0.05325845459210011, 0.04154563017750316, 0.02843157666706987, 0.013865743301951396, -0.0019387297473284178, -0.01899402544525872, -0.03707171379055877, -0.0560154034357869, -0.07552300556032786, -0.09552500533907933, -0.11573971652005179, -0.13614789512800685, -0.15664062401980022, -0.1772658794993368, -0.19803355803822364, -0.21900411658450072, -0.24004283796092046, -0.26109832338359507, -0.28183667988115046, -0.30229502937991143, -0.3222089625727401, -0.34178393778733174, -0.36109076747161145, -0.3803643385420656, -0.39956756525724474, -0.41881653931641266, -0.43794753421834637, -0.4569965437151163, -0.4757343945736771, -0.49406761221130696, -0.5117676887052233, -0.5287732067686187, -0.5452275031103893, -0.5612435190457435, -0.5768135009962072, -0.5919058919157801, -0.6063527564770277, -0.6201939094677161, -0.6331847388575186, -0.6451865405681813, -0.655987704020872, -0.6654785815737405, -0.6736642509716951, -0.6806791959208583, -0.6864961885678262, -0.691039730473822, -0.6941763687276874, -0.6958038917991246, -0.6957768773361255, -0.6940882472993287, -0.6907327476554525, -0.685629711534393, -0.6786376818324418, -0.6694591934790711, -0.6580636653800955, -0.6445961331006428, -0.6293057949610541, -0.6124759831730102, -0.5943003838270603, -0.5749557789721537, -0.5548017269380237, -0.5338986426741806, -0.5125518280071832, -0.49088528196911246, -0.4690751615297221, -0.4470774888068473, -0.42500816686464105, -0.40272608334035925, -0.38042450655658333, -0.35807800371085935, -0.33592893745667696, -0.31397151388008593, -0.2924050067847789, -0.27122948003341796, -0.25051728081861424, -0.23022828438997398, -0.21048890076663487, -0.19125479774898732, -0.17261531705982736, -0.1545334152009268, -0.13721093732928275, -0.12069281405889254, -0.1051236746509217, -0.09045417129792407, -0.07672829729759566, -0.06384376227037541, -0.05169687398319125, -0.04021965246241209, -0.029294010545801403, -0.01884907191841609, -0.008991699035979343, 0.00034532419771225416, 0.009128127407585814, 0.01747971747765401, 0.02553936776491369, 0.033427636930107925, 0.041216912911168226, 0.04889855844765762, 0.056407143389697434, 0.06368969056745558, 0.07063772690538844, 0.0772203702997038, 0.08343682894231094, 0.08920791150895162, 0.09451172353940147, 0.09918471986596739, 0.10320450541312519, 0.10660097695441514, 0.10938384298221769, 0.11155493356489282, 0.11313291242877441, 0.11401193496075104, 0.1140502698671175, 0.11302715916919755, 0.11081613730515849, 0.10726815934389404, 0.10259183440887283, 0.09684864870778735, 0.09026024679380601, 0.0828178362574144, 0.07462949079033483, 0.06551543689728376, 0.0554595537295104, 0.04431812052345318, 0.032109677948719606, 0.018757122691833977, 0.004444126038443885]
    single_pend_elbow_position = [-0.004009052991377238, -0.021660280518908552, -0.03959156064402346, -0.05794028975702733, -0.07663312224946967, -0.09579102735558138, -0.11531022607339558, -0.13523161267311024, -0.15537947468638433, -0.175695574423249, -0.19597536589814293, -0.21626684012649627, -0.23652388950754058, -0.25689272613312375, -0.2772449382614437, -0.2975947070358066, -0.3178090585878779, -0.3379791210756349, -0.35796364949483683, -0.3779206005832766, -0.3978133437152476, -0.4177617793245688, -0.4376893166744268, -0.4574960456317758, -0.4769681488189587, -0.4959820197316463, -0.514421983353097, -0.5322576910891439, -0.5493332840335271, -0.5656476845698781, -0.5809999849733133, -0.5952824553663669, -0.6084024519049851, -0.6203487924346386, -0.6311138896899895, -0.6407667257073115, -0.6492941775583966, -0.6566830303291824, -0.6628960417307889, -0.6679450896127179, -0.6716921666163645, -0.6741913967061521, -0.6752712654196052, -0.6748510921274109, -0.6728945918677066, -0.6693362820878113, -0.6641148580547712, -0.6568871339448332, -0.6475585408819821, -0.636151508260449, -0.6231164403841655, -0.6087978743727208, -0.5934491251560303, -0.5771806063561521, -0.5602780446842297, -0.5429880308414567, -0.5254961927832559, -0.5079741053893079, -0.4906708726264283, -0.47361909062931024, -0.4568460721017116, -0.44018082045244317, -0.42357967350719455, -0.4068407665489619, -0.38991767746177397, -0.3729087332726034, -0.35593838544286627, -0.3391074987896688, -0.32259158270055416, -0.30635292113844387, -0.2904361283361744, -0.2747368481532249, -0.2594327273227713, -0.24449209818816087, -0.23020450919451546, -0.21666569688101794, -0.20412813319791176, -0.1924592491220189, -0.18167261593546466, -0.17169175763085132, -0.16243887401143522, -0.1538997457878849, -0.14600653057483215, -0.13864402477017196, -0.13181673199264068, -0.12530862678715002, -0.11911871668889444, -0.11298579808617738, -0.1067075613921039, -0.10009890308312179, -0.09309356941426468, -0.08556737854910186, -0.0775489503180167, -0.06907439729523046, -0.06028046769681495, -0.051199359067642204, -0.04179328885672447, -0.03206692450258297, -0.02203720213864204, -0.011866820653872122, -0.001772927598123705, 0.008012239541199674, 0.017270823536837378, 0.02577980166896012, 0.03347683811736257, 0.04025450578143752, 0.046091275458604, 0.050838488434075, 0.05454294397419044, 0.05722128270797521, 0.05900883508924703, 0.059861722460152235, 0.05955799692923491, 0.05788533722365526, 0.05477294093001966, 0.050208346311093534, 0.04420168675763328, 0.03672353362411985, 0.028013125429563503, 0.01811330770318554, 0.00715159273293574, -0.004753121444379381, -0.017369618075971427, -0.030599584331297718, -0.04420790665819606, -0.05817497585343206, -0.07240690102034536, -0.08712343349306252, -0.1022231578733147, -0.11792882318414688, -0.1340946488347545, -0.1508125033192573, -0.16787213514158256, -0.18527644719428416, -0.2027215881014714, -0.2202850137862121, -0.23772459419374128, -0.25524076154104464, -0.27271269496435263, -0.29034476645658314, -0.308074770453619, -0.3260070737316671, -0.3439763897663496, -0.3620048492939076, -0.3797894445833485, -0.3973425067077198, -0.41436264747985424, -0.4308671224955661, -0.4467167199259063, -0.46205154591322306, -0.4768029155602912, -0.4910081971298016, -0.5045324709558371, -0.5173686696565003, -0.5293948768095044, -0.5405748380866371, -0.5507555664508114, -0.5598445720610482, -0.5677885363744489, -0.574579420017013, -0.5802140250503646, -0.5847883796140515, -0.5882586173886661, -0.5905736956411202, -0.5916848496834134, -0.5915715793018972, -0.5901693008782922, -0.587438440015467, -0.58332322329699, -0.5776827437541731, -0.5702435211822467, -0.5607309609098657, -0.5491973243801339, -0.5360533903239141, -0.5218508898464919, -0.5069652063555877, -0.49149634232667094, -0.4756380879094909, -0.45955352567007335, -0.4433709887500043, -0.4272385020842044, -0.41114477925324244, -0.3951659055435327, -0.3792974788255755, -0.363540020509833, -0.347614481821168, -0.331355462763562, -0.31453840513129283, -0.29719184194717485, -0.27938079375765296, -0.26144877109610926, -0.24359229277601288, -0.2259539148580829, -0.20857441407280233, -0.19147378338992913, -0.17463505643306512, -0.1582120926551924, -0.14219437845977437, -0.12682064829656345, -0.11206430889940489, -0.09803924281308093, -0.08470427716697798, -0.07206578148615714, -0.060023905248026505, -0.04863041336515005, -0.037751155635107704, -0.02741593847194364, -0.017566632075931267, -0.008230947642154474, 0.0006152826583366048, 0.008894342299883097, 0.01671991898368049, 0.024051020798863964, 0.031016878835101878, 0.03763809107920723, 0.04396515980007819, 0.05007903073832215, 0.056013780280487376, 0.061709991845622814, 0.06720409768900286, 0.07249505118374215, 0.07756362501835555, 0.08223493360673119, 0.08660642549840342, 0.09054802030855953, 0.09409622551544902, 0.09717952836367319, 0.09973019705248806, 0.10161828262477914, 0.10266033190128701, 0.10277746720223932, 0.1018193553522495, 0.1000008409807234, 0.09749711905786504, 0.09447073047533047, 0.09088834370936619, 0.08664671498802368, 0.08149334248709016, 0.07542940597262054, 0.0681876312316854, 0.05980182766465878, 0.05023271915085455, 0.039619945862950035, 0.027832133568991814, 0.01506925900567981, 0.001320658206823524, -0.013112945229454873, -0.028225620706293888, -0.04378125958481077, -0.05983546433082253, -0.0761985288567394, -0.09299905811755153, -0.11018117977361991, -0.12778849165219688, -0.1457040441868727, -0.16408033885467263, -0.1827401758517463, -0.20165734463169135, -0.22059625910731373, -0.23957498251380802, -0.2584688569230083, -0.2773692951470871, -0.29603813164167436, -0.31467339624737556, -0.3330731399284031, -0.3513875338383104, -0.36950778359031267, -0.3875214360367712, -0.40531530921854525, -0.42293693170771357, -0.4402013427773411, -0.45699777586607876, -0.4730272245427687, -0.48835934799960273, -0.5028796196828721, -0.5166696251669352, -0.5296493075118224, -0.5419539943433143, -0.5537279418092669, -0.5649677902537736, -0.575475072671873, -0.5851291263394771, -0.5937980221834971, -0.6013409991938476, -0.607692033474019, -0.6128202198675794, -0.616735408256462, -0.6194732048501107, -0.621063659773191, -0.6215213044534348, -0.6208009215974287, -0.6188880629294959, -0.6157202651837478, -0.6112119237702697, -0.6051813458727247, -0.5975045037012069, -0.5883346566211982, -0.5777558750703714, -0.5660253006855196, -0.5532859680041908, -0.5396941083813596, -0.5253988354805279, -0.5107509547917953, -0.49597703835100143, -0.4814718621298088, -0.4673642960233297, -0.45377184773900164, -0.44041982067860147, -0.42706870010874326, -0.4133926651633923, -0.399295453563452, -0.38478194380375913, -0.3700181038416896, -0.3550361717144541, -0.33999341543728195, -0.32492807387008105, -0.3099826725561529, -0.2951666371272791, -0.2805089613637614, -0.26603124090899183, -0.25180441269263476, -0.2379668854557827, -0.2247063158497775, -0.21207985200800378, -0.20019639456433888, -0.18895238440320766, -0.1782243643298861, -0.16791514687332554, -0.157966930285614, -0.14820950614503506, -0.13869211303440535, -0.12933117433510305, -0.12022065477733204, -0.11128303998579832, -0.10248714652590506, -0.09371349631360273, -0.08496978229957734, -0.07612281042002424, -0.06720273351188157, -0.05813189869338455, -0.04898126653004342, -0.03977679678663049, -0.030536329504081777, -0.02127033247900939, -0.012044455760539967, -0.0028993236972432055, 0.006058070209530654, 0.01478104579874761, 0.02318730134411447, 0.031240092932417775, 0.03870912013407082, 0.045420274377507446, 0.05123471167030694, 0.05587584551167716, 0.05930042566483017, 0.06147010821573286, 0.06256516085611949, 0.06277801353725578, 0.06214703127379651, 0.06047991510505867, 0.0576120533973415, 0.05330401708701052, 0.04753538571844053, 0.0401873071831025, 0.03132460692641207, 0.020969021715791427, 0.009222994878919845, -0.003924153274265841, -0.018253906289984696, -0.033852037498990135, -0.05041190814287088, -0.06795943616796353, -0.08629082674965652, -0.10558212626861878, -0.12569063181738815, -0.14666227106176694, -0.16837802877734168, -0.19074680386991033, -0.21344361083268787, -0.23635673899602544, -0.2592814156531521, -0.28224312270135193, -0.30502827128595883, -0.3276641993386163, -0.3499658039445863, -0.37214922548982393, -0.3940631780707293, -0.41570368904233634, -0.4368576792949847, -0.4575198580184943, -0.4774045094300108, -0.4964792816551922, -0.514671123564889, -0.5320379144085065, -0.5485278946791406, -0.5641810623591634, -0.5789045216728488, -0.5927485010080713, -0.6056622277030808, -0.6177832325745644, -0.6289857882557983, -0.6392777910358144, -0.6486528120105116, -0.6571435608853499, -0.6645650546878219, -0.6709764348222477, -0.6760939218431085, -0.6799940158053662, -0.6826165512709301, -0.6840259394953088, -0.684300686872249, -0.6835161661744272, -0.6816394622166888, -0.6787517282314899, -0.6747687974277029, -0.6697110589238223, -0.663424121460843, -0.655657031422541, -0.6464373042206378, -0.6360452478499417, -0.6247564754681735, -0.6126424293310835, -0.5996913872153, -0.5859044459074687, -0.5714669361844477, -0.5565998054582744, -0.5416760621197595, -0.5269220590134354, -0.5125641427545268, -0.49851702784225443, -0.4846281853372712, -0.47053992315977605, -0.45617698343789104, -0.4413808133787107, -0.4262594422424229, -0.4109177331124401, -0.3956385351841063, -0.38044027121012425, -0.3654005022884864, -0.35047026695279987, -0.3355230224183276, -0.32044547436502574, -0.30528425698666095, -0.29000526279967975, -0.274913801340637, -0.2600416535019508, -0.24560973503297415, -0.23160970950215143, -0.21819386618387343, -0.2051441121199211, -0.19250330079824293, -0.18011082973670406, -0.16804290515047893, -0.15619058098752095, -0.14466053524288205, -0.13327483290353495, -0.12223773268370741, -0.11138751817549701, -0.1008229559654045, -0.09046848226374793, -0.08024998881618563, -0.07005801132240569, -0.05988531569732861, -0.0496621494843016, -0.03942590384416825, -0.02912157301817313, -0.018853734749686973, -0.008584825648750904, 0.0015701879366806766, 0.011564270739116003, 0.02143322990839489, 0.031141864530412646, 0.040519112941559306, 0.04940228655365487, 0.05767430532097272, 0.06508137124211061, 0.07151199606095543, 0.07683137642816407, 0.08103704314043399, 0.08424803161755415, 0.08649335489532108, 0.08764161477124993, 0.08770854788982112, 0.08655862616935919, 0.08411937702654328, 0.08012735999211705, 0.07454616156437768, 0.06740755543648717, 0.05883260800681693, 0.04883008913437594,
                                  0.03755144680908926, 0.025008045295278298, 0.011415460531530513, -0.0032117137451260283, -0.01867394995855468, -0.0350812930013687, -0.05218625452051429, -0.07020175653295208, -0.08896188445746611, -0.10858118713180132, -0.1288401883255747, -0.14970720736996, -0.17089544158983197, -0.19235114023299277, -0.21395943756087535, -0.23573783555761174, -0.25752894883602157, -0.27939731252836825, -0.30113227976663043, -0.3227604811218131, -0.3440996172194887, -0.36510587079651124, -0.3856009058731241, -0.405787307697986, -0.42557531197509185, -0.44510370391430604, -0.4641441977315171, -0.4826642135137878, -0.5006046646195069, -0.5180558922553331, -0.5348572454880653, -0.5509471356514571, -0.5661574424294507, -0.5806104816622625, -0.5942842553193246, -0.6072322137398172, -0.6192916476688558, -0.6304247135031951, -0.6404168212052703, -0.649301128753071, -0.6570324374473867, -0.6636041926843288, -0.6688932827653582, -0.6728851175403241, -0.675455749376101, -0.6766983634776782, -0.6766605199854685, -0.6753328246991706, -0.672574220533739, -0.6680155390290501, -0.661401852894565, -0.6527290488548149, -0.6424479612169794, -0.6309950252882218, -0.6186395534639815, -0.6056128279307077, -0.5920908918602237, -0.5782189394120866, -0.5642134208157634, -0.5500890004197028, -0.5358976227963592, -0.5215188765651243, -0.5068546840386406, -0.4918067906754993, -0.4763281750491219, -0.46023127572049966, -0.44357910905936715, -0.42637373820072916, -0.4089048520182328, -0.391177297301317, -0.3734133427901665, -0.3554969989395599, -0.33751861032861985, -0.3194213435108635, -0.3013974465419669, -0.2834524297239955, -0.26574101997895444, -0.248434488688553, -0.23160274840974868, -0.2152570972876709, -0.19941335669347254, -0.18389691326128263, -0.16877394358657727, -0.15388627190292745, -0.13932405350622623, -0.12494619381341741, -0.1107922715807316, -0.09682893486612648, -0.0832301478140474, -0.06999607228801141, -0.057187564568454384, -0.044692971875998695, -0.03248533730034854, -0.020537545280997653, -0.008871948457614545, 0.0026498276695343676, 0.014035380868554298, 0.025357895467900855, 0.036465039392363244, 0.047355874935383825, 0.057869820444835005, 0.06798924659800244, 0.0776655290238489, 0.08676935106092373, 0.09524083124745898, 0.10294686466492678, 0.10980134843753005, 0.11558833575279485, 0.12024025415102135, 0.12359729612482322, 0.1255443654992991, 0.12618205753148268, 0.12559294447375385, 0.1237636782642745, 0.12086633333351568, 0.1168713141269694, 0.11183041912504195, 0.10545775085997791, 0.09752426723010282, 0.08787328169637812, 0.07664115670894907, 0.06384992312821727, 0.049666043894034534, 0.0340850062104677, 0.01732370253402352, -0.00042832197187077825, -0.018932600229958428, -0.038081146171022505, -0.05766753289978527, -0.07770376618360236, -0.09818931244410574, -0.11934153330430439, -0.14116567037648756, -0.16375693796572846, -0.18683093945854937, -0.21023522249899365, -0.23366143854953667, -0.2570668923860136, -0.280276057592374, -0.3033422046761036, -0.3261310580223998, -0.34869874575953963, -0.3708677339100732, -0.392656301670405, -0.41386090960984484, -0.4345106043064239, -0.4543494195860855, -0.4734442466639164, -0.49184001173032255, -0.5094739810490045, -0.5263442898718654, -0.5424037265751391, -0.5575479793208552, -0.5718096304287165, -0.5850509927962981, -0.5972708253092762, -0.6084151620350706, -0.6188497859846497, -0.6284796768724585, -0.637295323254808, -0.645013454350201, -0.6515813363400805, -0.6569416905091054, -0.6610243265579736, -0.6638437421831666, -0.665340434892804, -0.6656040445394055, -0.664753157625625, -0.6628650340549782, -0.6599382105737331, -0.6558791843251078, -0.6505976490305969, -0.6439724248245435, -0.6357730180818056, -0.6258136373369907, -0.6141623874911902, -0.6011423383368966, -0.5871180867343876, -0.572330802683237, -0.5567721903740543, -0.5407017695110721, -0.5242438426709917, -0.5076501210328342, -0.49109524245596714, -0.47478158790678254, -0.45873604487318864, -0.44297375072731204, -0.4273543239310891, -0.4117485741239075, -0.3957941470129053, -0.3794783975589308, -0.3626658797381016, -0.34554631535327396, -0.32816396340121134, -0.3107183146164492, -0.2932122518771018, -0.2757386344565461, -0.25836288939845536, -0.2411819784953997, -0.22425081310926356, -0.2078014780238131, -0.19194092106457666, -0.17695009477567614, -0.16286918538019265, -0.14978792911894478, -0.13752888959055184, -0.12593870064661872, -0.11479636881742575, -0.10410259593311262, -0.09366835711659466, -0.08356671487517744, -0.07372611835949383, -0.06410155649362292, -0.05466499767690666, -0.04531234681734709, -0.03602825607395858, -0.02687475548673273, -0.017778976143623185, -0.008708603196549093, 0.0004436647080284786, 0.009712142197443109, 0.01921637491674026, 0.028820868112382395, 0.03853107426086622, 0.04820959111997894, 0.057726504223116995, 0.06696593197968805, 0.07583196051121938, 0.0841629570420087, 0.09184557751745816, 0.09863357570310562, 0.10428166603337574, 0.10869007278003692, 0.11172132338132215, 0.11336913804202144, 0.113470082368397, 0.11200855935165113, 0.10884581877414298, 0.10415693665950759, 0.09789763637675344, 0.09010300734554871, 0.08071137462821446, 0.06987305822901614, 0.05749545522952525, 0.04369835664204632, 0.028550779031932864, 0.012193205937224554, -0.005243663660990418, -0.023542312724472016, -0.04258392732939059, -0.06209499822841899, -0.08220807152108013, -0.10280457891632576, -0.12403500990576934, -0.14579659298187983, -0.1679333986833889, -0.19018434807743467, -0.212537370513572, -0.23476615739818302, -0.25702098777081317, -0.27908465509697344, -0.3010328255005871, -0.3226940493211952, -0.34402224044911783, -0.36486637855167986, -0.38512780987545453, -0.40466404057891936, -0.42351495058580696, -0.4417786207454606, -0.45941577043646475, -0.476307820406005, -0.49257073228606213, -0.5079984589837103, -0.5225911319822184, -0.5363125591637546, -0.5491844869790066, -0.5611696718608037, -0.5723747767145363, -0.5827108435582192, -0.5922832143173734, -0.6009687139201806, -0.6087139356047532, -0.6154305660414806, -0.6211985985096473, -0.6259326362798754, -0.6297672128962181, -0.6326580398949898, -0.6347105804695128, -0.6357609858383105, -0.635851850551563, -0.6349969984146705, -0.633255894708381, -0.6307012904789459, -0.6272927562380687, -0.6229569146715842, -0.6175131960619755, -0.6106166000826856, -0.6021767382857485, -0.5924984591318105, -0.5819616382679095, -0.5708479282318918, -0.5593248030536326, -0.5475855616596123, -0.5357754956914227, -0.52403577375085, -0.5123643302445927, -0.5008967176022578, -0.4895530418070205, -0.47843300445372766, -0.4672904361101815, -0.45611406514157415, -0.44451813593776685, -0.4324442710966015, -0.4196766358873923, -0.4062699197472391, -0.3922188437799386, -0.3777697126806798, -0.36286968268059805, -0.34763041542771567, -0.3318762996940919, -0.3157667399015494, -0.2993236346420375, -0.2827730559460676, -0.26613022329041863, -0.24967223444408088, -0.23343848168132733, -0.21754770205933685, -0.20191087033156052, -0.18663169041405436, -0.17161391629675782, -0.15695796213873417, -0.1426551271817433, -0.12882098694886354, -0.11548522567216978, -0.10279295623404396, -0.09061218611491448, -0.07896425656862471, -0.06766221391519876, -0.05668841173498818, -0.04579690013496016, -0.035031901716840154, -0.024333371280884586, -0.013747705908444874, -0.0031481062881372097, 0.007389042361172605, 0.017980569607988023, 0.028509426160190737, 0.03894659107095814, 0.04921060764481318, 0.0591771531274173, 0.0688424520941939, 0.0780661055448655, 0.08671567432612573, 0.09466154201141538, 0.10170812927435245, 0.10769150876373339, 0.11240979012783164, 0.11581091608160196, 0.11799083410982317, 0.11905132656298253, 0.11907828983375725, 0.11797072928733149, 0.11554910185699181, 0.11161337694007509, 0.10619352395898803, 0.0991752174076241, 0.09063015686568417, 0.08050970600470311, 0.06912018297522526, 0.05650519223288281, 0.042866475562266367, 0.028191281235239417, 0.01266688337665762, -0.0037265814478407203, -0.020741649113280882, -0.03851105583944567, -0.056811126875307, -0.07579539758662487, -0.09531985547209357, -0.11560064232929859, -0.13630261377972594, -0.15750960794526858, -0.179020428859866, -0.20084783771211182, -0.22278678319907003, -0.24478694602395576, -0.26664423499937107, -0.28837291471679377, -0.3097711235954938, -0.33110117345819706, -0.35225982241155884, -0.3733421005699643, -0.3942047539896194, -0.414776516814288, -0.4348292270634099, -0.4543326096888512, -0.47304067358827295, -0.4910730218722067, -0.5083983084999637, -0.52515915584005, -0.5413034736696438, -0.5569045126206319, -0.5718659648284053, -0.5860179081607234, -0.599194921057907, -0.6111867261232174, -0.6218148478370391, -0.6310233629798072, -0.6387003655661156, -0.6449702730044057, -0.6499395963928603, -0.6537395621723482, -0.6561525425528728, -0.6571090821226906, -0.6564168901239054, -0.6540696791109215, -0.6500519959307653, -0.6443117051488839, -0.6368334301830476, -0.6274965792464582, -0.6162345466624288, -0.6030569284682973, -0.588380774095801, -0.5724675199482065, -0.5555073187895523, -0.5376550894469887, -0.5193309546123202, -0.5007597014091871, -0.48234456877284926, -0.4641580599761643, -0.446269240456718, -0.42857501641760426, -0.4110037310971541, -0.39349712135502046, -0.3760469871385727, -0.35861839517204025, -0.34135568930281707, -0.3242548202162766, -0.30748294905685875, -0.2910140105679194, -0.27487389694079944, -0.2589581444406421, -0.24335120110661784, -0.2279743011219743, -0.21293272780137482, -0.1981401751451947, -0.1837937115358235, -0.16993532152902543, -0.1567818416991502, -0.1442476378181884, -0.1323385762775737, -0.12087973924425148, -0.10982305876304256, -0.09905936871530956, -0.0885395772409814, -0.07818340109941414, -0.06811896232392639, -0.05828308744804422, -0.04878610400259234, -0.03950075448451784, -0.03052321080896068, -0.021740594252848317, -0.013143842503091698, -0.004730381139065432, 0.003497290427062338, 0.011623186162824184, 0.019621974613267312, 0.0275314432378925, 0.03536312004366809, 0.04311101128347149, 0.05070621444753279, 0.05807381910792649, 0.06517014223472757, 0.0718961366330106, 0.07825466272887947, 0.08407409745732027, 0.08928097675217, 0.09359377806976746, 0.09673442219800904, 0.09839713014674804, 0.09840933302726462, 0.0967398627301828, 0.09375810729866343, 0.08955902787105653, 0.08429970643144738, 0.078068219664741, 0.07098155727353803, 0.06296677907754088, 0.05390144376826422, 0.04359509015860439, 0.03207731524859755, 0.01918191761047947, 0.00502427220889839]

    if use_double_pendulum:
        elbow_pos = double_pend_elbow_torque
    else:
        elbow_pos = single_pend_elbow_position

    motor_kv = 115
    torque_const = 8.27 / motor_kv

    input_pos_plot = []
    output_current_plot = []
    output_pos_plot = []
    output_vel_plot = []
    t_plot = []

    plot_rate = 1 / 100
    plt.figure(figsize=(100, 25))
    plt.suptitle('Odrive Output', fontsize=75)
    plt.subplot(211)

    for i in range(len(elbow_pos)):
        try:
            t = i * plot_rate
            input_pos_plot.append(elbow_pos[i])
            t_plot.append(t)

            driver_name.axis0.controller.input_pos = elbow_pos[i]
            clear_errors(driver_name)

            output_pos, output_vel, output_current = get_motor_state(
                driver_name)
            # print("Moving to {} [turn]".format(output_pos))
            # print("Moving at {} [turn/s]".format(output_vel))
            # print("Motor current is {} [A]".format(output_current))
            print("The position error is {} [turn]".format(
                elbow_pos[i] - output_pos))

            output_pos_plot.append(output_pos)
            output_vel_plot.append(output_vel)
            output_current_plot.append(-output_current * torque_const)

            plt.scatter(t, elbow_pos[i], c="blue")
            plt.scatter(t, -output_current * torque_const, c="red")
            time.sleep(plot_rate)
            # plt.plot(t, elbow_pos[i])
            # plt.plot(t, output_pos)
            # time.sleep(plot_rate)

        except:
            print("Couldn't complete motion. shutting down")
            shut_down(driver_name)
            raise

    plt.plot(t_plot, input_pos_plot, c="blue", label="Input position")
    plt.plot(t_plot, output_pos_plot, c="red", label="Output position")
    plt.ylabel('Torque [Nm]', fontsize=50)
    plt.xlabel('Time [sec]', fontsize=50)
    plt.grid()
    plt.title('Input & Output torque', fontsize=20)
    plt.legend(fontsize=50)

    plt.subplot(212)
    plt.plot(t_plot, output_pos_plot, c="blue", label="Output position")
    plt.plot(t_plot, output_vel_plot, c="red", label="Output velocity")
    plt.plot(t_plot, output_current_plot, c="green", label="Output torque")
    plt.xlabel('Time [sec]', fontsize=50)
    plt.grid()
    plt.title('Output Angle, Velocity & Torque', fontsize=20)
    plt.legend(fontsize=50)

    plt.savefig("output.png")

    # plt.ylabel('Angle [rad]')
    # plt.xlabel('Time [sec]')
    # plt.grid()
    # plt.title('Odrive Output')
    # plt.savefig("output.png")

    # # A sine wave to test
    # t0 = time.monotonic()
    # while time.monotonic() - t0 < 10:
    #     try:
    #         pos = 4.0 * math.sin(2 * (time.monotonic() - t0))
    #         driver_name.axis0.controller.input_pos = pos
    #         clear_errors(driver_name)

    #         output_pos, output_vel, output_current = get_motor_state(driver_name)
    #         # print("Moving to {} [turn]".format(output_pos))
    #         # print("Moving at {} [turn/s]".format(output_vel))
    #         print("Motor current is {} [A]".format(output_current))
    #         # print("The position error is {} [turn]".format(pos - output_pos))
    #         time.sleep(0.01)

    #     except:
    #         print("Couldn't complete motion. shutting down")
    #         shut_down(driver_name)
    #         raise


def velocity_control(driver_name, use_double_pendulum):
    driver_name.axis0.controller.config.control_mode = CONTROL_MODE_VELOCITY_CONTROL

    # A sine wave to test
    t0 = time.monotonic()
    while time.monotonic() - t0 < 11:
        try:
            vel = 1 * math.sin(4 * (time.monotonic() - t0))
            driver_name.axis0.controller.input_vel = vel
            clear_errors(driver_name)

            output_pos, output_vel, output_current = get_motor_state(
                driver_name)
            # print("Moving to {} [turn]".format(output_pos))
            # print("Moving at {} [turn/s]".format(output_vel))
            print("Motor current is {} [A]".format(output_current))
            # print("The velocity error is {} [turn/s]".format(vel - output_vel))
            time.sleep(0.01)

        except:
            print("Couldn't complete motion. shutting down")
            shut_down(driver_name)
            raise


def current_control(driver_name, use_double_pendulum):
    driver_name.axis0.controller.config.control_mode = CONTROL_MODE_TORQUE_CONTROL

    # double_pend_elbow_torque = [0.0499143354412735, 0.204162223450821, 0.370015943634173, 0.218227263458353, -0.127438738630574, -0.236075281642606, -0.193194481977725, 0.105520745574681, 0.0165531161344873, -0.0633163426391059, -0.372883023139634, -0.451868452746905, -0.814183149122022, -1.00240334531892, -1.10340598360931, -1.04698334199183, -1.11016438820848, -1.13523074019667, -1.15923982525603, -1.16660132020808, -1.16575511576351, -0.903957553655423, -0.741089756379909, -0.518655168502782, -0.541473150764457, -0.414495294312505, -0.598996730232369, -0.486832279216576, -0.569242299087136, -0.510925051345119, -0.645599594941664, -0.565250437442744, -0.654189809719308, -0.637001375833302, -0.622746700432922, -0.453825081830585, -0.328053692734653, -0.139378110802159, -0.0226978077420807, 0.0399643920581434, -0.0453588120380301, 0.0747278985133100, -0.0373742752120132, 0.0969642810848846, -0.125473430278461, -0.0851666223558286, -0.242157205693985, -0.244328338297983, -0.419608063796381, -0.492012288085464, -0.631473095144125, -0.670071771145777, -0.720441454359586, -0.602915034055448, -0.620715070083484, -0.535565983754901, -0.487743554257328, -0.555457800920405, -0.593158007322087, -0.745978522570029, -0.888201897221053, -1.00381735805054, -1.08913677950497, -1.07199261948793, -0.992963923966105, -0.835348825553688, -0.538532433394696, -0.142111055766831, 0.181946329633647, 0.196340013655786, 0.0830285103936173, -0.269497968817808, -0.430418982282854, -0.645702713392315, -0.600563767335001, -0.731905191942771, -0.582434630243116, -0.569283556331578, -0.375964885006990, -0.361063980651086, -0.158999885384354, -0.137314912607776, -0.112320634118735, -0.269709523867728, -0.379791450910081, -0.531126050539834, -0.497987601932206, -0.586647743837750, -0.517090465668096, -0.572644746098176, -0.389409900195855, -0.438945436098258, -0.325721746207817, -0.378177144730898, -0.326274079959821, -0.409653997853592, -0.241605348441148, -0.351413158099011, -0.279993280306094, -0.354500759753484, -0.355663674317407, -0.483774749893963, -0.520666810869356, -0.598192361823965, -0.529650229047080, -0.556052618966703, -0.474976924760912, -0.566591452947983, -0.630500938773891, -0.529081647738360, -0.532750068146182, -0.414863400130767, -0.342745552063163, -0.364098678713805, -0.237526267507533, -0.444896898292913, -0.486215322791979, -0.565657463788148, -0.566053564485880, -0.523429993267808, -0.412115307377813, -0.168723721101527, 0.0773271283195989, 0.0842087736070609, 0.00122059280886778, -0.218816788582694, -0.594513155026799, -0.633109968409603, -0.476251961269172, -0.132026958042113, -0.125572710243167, -0.191384029058338, -0.400452610205723, -0.270840989333138, -0.447849699264579, -0.499864053872226, -0.768350438603515, -0.810067741669969, -0.863807709276244, -1.05233788086538, -1.10832888854663, -1.07860879232144, -0.977330846171363, -0.806822626708632, -0.782778708795093, -0.674831291077670, -0.713229906837986, -0.375989179498735, -0.429122620143505, -0.322508344908484, -0.418677874669079, -0.296110274090266, -0.345213600895460, -0.273464054377142, -0.297247462128352, -0.118787061178545, -0.253350378177666, -0.215442990700036, -0.326359532160066, -0.239088947820901, -0.327371650908999, -0.337170343665548, -0.478486213253344, -0.481579066670643, -0.628149705607622, -0.512104977252328, -0.496100168935273, -0.366288642468867, -0.449455583621386, -0.330160812381470, -0.478609151107264, -0.455862798099527, -0.619446434029523, -0.600761442414897, -0.584351412598547, -0.536346810947464, -0.405241716736946, -0.326476969117315, -0.218482286504809, -0.247598050371604, -0.132092101840161, -0.307161982927484, -0.384142308861133, -0.554427540598627, -0.545674600175741, -0.776824514023566, -0.752704540453396, -0.643367509170241, -0.270615490238674, 0.118971007592379, 0.242172578948757, -0.0418823194152457, -0.256232653880842, -0.531507241664745, -0.434022253827431, -0.518536385048202, -0.239385378486550, -0.167636981098419, -0.100662981984718, -0.0279701267809940, -0.0224942328844012, -0.340932720456289, -0.317729156165206, -0.268174815658828, -0.0252199503393233, -0.128258737100892, -0.0965478104766318, -0.351935479328412, -0.424136987080224, -0.542027133947336, -0.452468223709300, -0.372260654603136, -0.138433784591940, -0.168873435368833, -0.183389799829516, -0.431530197684980, -0.582669196545488, -0.652646235424380, -0.572449369545484, -0.611919732612274, -0.506695986921562, -0.541017562070882, -0.477212559382473, -0.545960822758120, -0.554416316905721, -0.631854453047865, -0.535009617167182, -0.500584646849081, -0.409007773746548, -0.378503215723804, -0.394931288085920, -0.595162495017394, -0.678193529714429, -0.741567604098728, -0.752300770883449, -0.632367864056054, -0.421998028353477, -0.238752533462740, -0.165667377217805, -0.326778064331313, -0.507670503032700, -0.629103192118884, -0.542812044175882, -0.276878773920104, 0.123667766193885, 0.214618589847280, 0.212513799677500, -0.166788225272741, -0.474443480130484, -0.416541888344052, -0.0647574022607760, 0.0959617685570273, -0.150087426303854, -0.419224215225113, -0.649197998482106, -0.668067370852563, -0.784302148729086, -0.748335012920666, -0.786015231291000, -0.680266830012807, -0.887964380954745, -0.877750799639737, -1.03465141281905, -0.993317597791412, -0.748947494890102, -0.426241744570977, -0.262010228091237, -0.259450011015421, -0.389732954598112, -0.462245303412592, -0.592386779833998, -0.440621416811178, -0.392435342638985, -0.300771712899687, -0.283557817576167, -0.184549749612875, -0.402064522215379, -0.289620620478022, -0.353113170713020, -0.188243951926062, -0.244077067495580, -0.0272168011442369, -0.0108484076153736, 0.147677862478397, 0.0521127013505180, 0.0439012535113068, -0.0613972457812226, -0.175349319895883, -0.324918537354058, -0.421275708525467, -0.426394590349964, -0.431519390618132, -0.455804762100618, -0.463249633528945, -0.568738533129124, -0.567272713737906, -0.549234018651487, -0.516498877976941, -0.388024184187620, -0.324108319699220, -0.306148328732882, -0.321607087999873, -0.436514622152976, -0.628480920080857, -0.695005934517472, -0.829012080591318, -0.706249419365019, -0.833547492723288, -0.745526480922354, -0.694709425740696, -0.256365113242379, 0.123747881406935, 0.314482264698862, 0.206790559442149, 0.0184459378227147, -0.302990600036068, -0.575652048420915, -0.729649716779698, -0.692345287515764, -0.711646815580425, -0.525415318025212, -0.513074147657287, -0.342169204113819, -0.420681192242934, -0.208109641736670, -0.198799508482381, -0.0479597735504211, -0.131332291163487, -0.0973484445372870, -0.226989584419659, -0.261729187323968, -0.272305002216525, -0.413027376449797, -0.382705324181702, -0.403733214277217, -0.444437992157285, -0.420044666119253, -0.453625462638606, -0.442107865655960, -0.449779394143823, -0.490604967665039, -0.592168629338395, -0.467701145653935, -0.406648082394555, -0.316187299305176, -0.371099880889006, -0.250500000644710, -0.427106931988737, -0.515085034607461, -0.673578732392407, -0.795713575798928, -0.829965969774057, -0.791490061824731, -0.718302724797260, -0.603664992318817, -0.491462860356187, -0.447875847462441, -0.552436343420368, -0.686124536994439, -0.771994821664253, -0.725376260046762, -0.543712584745572, -0.365347918198339, -0.142834428319523, -0.101601646744519, -0.149485282540183, -0.166857619357702, -0.218557411399220, -0.114651446493595, -0.0984633829599228, -0.124062820484516, -0.265937957138256, -0.440730166246034, -0.498853197931698, -0.410813345910133, -0.356472095089592, -0.516528973740632, -0.598007375971390, -0.505030601352448, -0.480509349845714, -0.290295228788898, -0.400187986275268, -0.651691551762665, -0.789754104675250, -1.08170967980648, -1.18590142599330, -1.21269337341099, -1.05887891251143, -0.789408526433249, -0.452021588825589, -0.334443557865586, -0.235089020649121, -0.366703042635601, -0.418838728659996, -0.525439670317392, -0.562132819983617, -0.609962523340134, -0.571665160613400, -0.668619248088447, -0.533501494030415, -0.655109386219020, -0.571025622115516, -0.603534487610678, -0.448587200945068, -0.364651641383058, -0.108518355177348, -0.0470080861454823, 0.104769425853138, 0.0693709966021063, 0.139922601336971, 0.0276869374953551, -0.00407568428395389, -0.0479434592623646, -0.112155708180593, -0.318002738835695, -0.403305863879680, -0.505847912263763, -0.507284241778705, -0.629990300258772, -0.548638756463222, -0.494165145687148, -0.335236503043683, -0.286193814837713, -0.289001018172729, -0.359149064993979, -0.587163001059093, -0.705822417733764, -0.904418920400488, -0.925162346853522, -0.931801477805855, -0.789394445424011, -0.681651527970510, -0.547784429290967, -0.335333656295091, 0.0514097079444240, 0.337650399585689, 0.540971230674545, 0.289937564018578, 0.104935323524139, -0.252448228000690, -0.359620105431453, -0.564972403661453, -0.420714751844030, -0.399673645382574, -0.246478910260191, -0.245809417859752, -0.0867218297877262, -0.0896386279065616, -0.0316375626153287, -0.178400422664510, -0.226842116068768, -0.371867782761753, -0.420970303766131, -0.559881079252271, -0.532200108224339, -0.633612106318613, -0.478306614365834, -0.580736355149616, -0.331325254804671, -0.428895909495944, -0.394439960765804, -0.436267418093604, -0.423483385321462, -0.397455580139220, -0.220816935638154, -0.185494348311614, -
    #                             0.110667261817397, -0.187809363604655, -0.381045308262968, -0.447842580043814, -0.574258365902772, -0.643447238421549, -0.552860545784985, -0.531522792217555, -0.371210465013133, -0.279049197897802, -0.213917177758665, -0.373145987693766, -0.514016180669512, -0.675838796392660, -0.754885477327969, -0.838409443012120, -0.723614300250174, -0.522825635647471, -0.292367883059965, -0.171689472712285, -0.177153395785862, -0.188002135747383, -0.242298874409158, -0.219815841628539, -0.155726607757981, -0.0735196705014036, -0.0566612748370910, -0.247135296991432, -0.476200203722273, -0.509053428464434, -0.263877154112039, -0.0742148799430066, -0.184937957799772, -0.220571743339316, -0.420653226774394, -0.212513712889183, -0.314411719054715, -0.361824948242141, -0.449629833991592, -0.520535350962287, -0.636869854620166, -0.726923824728660, -0.906467637295752, -0.922804731485284, -0.840390617686214, -0.582298436961312, -0.524195637349270, -0.545626296754341, -0.639526820631271, -0.668427085651708, -0.578275872746848, -0.547598235244129, -0.425964701747962, -0.278385296678506, -0.294783981352044, -0.159714721198569, -0.314545002370503, -0.325237516340772, -0.333108960664106, -0.223480587806767, -0.134759456331820, -0.0170146014336560, -0.00444915030808037, 0.0928362187027976, -0.109755017380885, -0.0217855136644398, -0.136715764459217, -0.152233653746173, -0.222426126002302, -0.201654534565738, -0.250091437213342, -0.263415706346977, -0.414200003477546, -0.281050521829360, -0.478415926549440, -0.366455965325389, -0.422630948799375, -0.413284251658424, -0.286222346104053, -0.312568447457402, -0.387391367161785, -0.493536220590987, -0.581224147002503, -0.802128187278010, -0.947313140558365, -0.915117974106225, -0.811327356152493, -0.628687043177985, -0.511459712978193, -0.361755580559018, -0.332255528597417, -0.148433173875048, 0.235316659066221, 0.361301731985229, 0.349710913522449, 0.111940732635857, -0.212211869513117, -0.476039029894498, -0.508024995824675, -0.526827021166315, -0.381032603928581, -0.396688010032448, -0.218273680365376, -0.318703455222702, -0.319236074626257, -0.440922728904923, -0.380191760701004, -0.348597038928950, -0.203495407142243, -0.270799398466238, -0.303142021932604, -0.450976475370920, -0.465993057876728, -0.638880964571269, -0.526822883714460, -0.639816846438920, -0.537155334526610, -0.618900071199556, -0.460377951664284, -0.499884587066612, -0.426713236441133, -0.588808938476075, -0.446956173284689, -0.581276697844987, -0.569607318868107, -0.649908813557578, -0.631153480804139, -0.657486525959149, -0.631868203054338, -0.529725348394828, -0.487376251113249, -0.436116575302934, -0.442854508557080, -0.569429743172080, -0.671719024966943, -0.835630034174968, -0.830612175277612, -0.942410793376069, -0.813600850525892, -0.777027309850113, -0.635130052821686, -0.541930877449206, -0.448205911489987, -0.399140720280838, -0.343464458669160, -0.132449908973279, -0.0510059430395625, 0.246319328047748, 0.317957709004808, 0.187716812838736, -0.107674974031306, -0.416972127542770, -0.690529504745146, -0.578731376014012, -0.286272826514908, -0.0256311290814649, -0.298415580667634, -0.570505713971310, -0.875642078411088, -1.05847423629138, -1.12047192745774, -1.04936282833566, -1.06098284356570, -0.945162944298493, -0.905833189682869, -0.653482161613261, -0.578910539580732, -0.473202136929573, -0.540771955434290, -0.618040776606848, -0.819542970654109, -0.916018680410496, -0.958380248656181, -0.749533684890252, -0.724070189862858, -0.478438139562340, -0.675793483900665, -0.540465201189436, -0.703418960139613, -0.672107016929164, -0.779258458654682, -0.595702341277635, -0.571445565364839, -0.341653530820402, -0.244769964993817, -0.186061435617295, -0.236191414731814, -0.215622415215494, -0.332624923748554, -0.363947998459806, -0.386692131092421, -0.276878015170163, -0.410358805664876, -0.317607914098433, -0.489205713228633, -0.405101768943888, -0.433672752268030, -0.455393998995503, -0.480583788425479, -0.442645403447282, -0.354184272518638, -0.263111144848651, -0.320218850960744, -0.206334499054678, -0.375982693039095, -0.433268577328072, -0.555035111147057, -0.795471069641327, -0.923091805296162, -1.04437372513619, -1.15658973968369, -1.18849798813652, -0.760771940086275, -0.351178281537922, -0.139379469967236, -0.254176200506696, -0.392087317249257, -0.665591348007819, -0.950326045874445, -0.839287298503531, -0.644854130129622, -0.568730761210695, -0.381032274338312, -0.488021869882493, -0.392779633139644, -0.626554282013687, -0.424062306858339, -0.514225021250116, -0.196569952911202, -0.0270177442388938, 0.211707038712557, 0.115705321121430, 0.112775129183187, -0.227609858102594, -0.368222384106844, -0.600108304828780, -0.521920581966523, -0.585944259126957, -0.370489422743671, -0.350859132902092, -0.162128877160285, -0.417269491792199, -0.345477018623432, -0.506917356614462, -0.395201059160002, -0.356367616098277, -0.281707688525424, -0.345137996556668, -0.192098421647855, -0.401743944166268, -0.418495606518999, -0.547119637997368, -0.565444782638184, -0.621630187778962, -0.569578300823038, -0.595307737256621, -0.465965745250481, -0.446326026053271, -0.485931443102562, -0.535468246509105, -0.582913720899056, -0.679400773820643, -0.725378565412524, -0.770367205334818, -0.635896336192025, -0.546259643587946, -0.337828864482814, -0.162422046666413, -0.0350236148499837, -0.0179630578925893, -0.0467007292450958, -0.133465460831618, -0.181175753545972, -0.169139685303552, -0.382989763763490, -0.432186907655895, -0.372926204774896, -0.137904620819384, -0.0731472622220627, -0.166823030327231, -0.473024708841081, -0.539530619182885, -0.743667748238901, -0.603112506498652, -0.587876815153649, -0.540702581066388, -0.730030447705115, -0.833474831981347, -1.12885712389862, -1.14162738535446, -1.31484689263088, -1.26295259233310, -1.25948658139817, -1.05158095662180, -0.900361639175895, -0.697242467966453, -0.449875672315359, -0.442752149943864, -0.500747562211526, -0.556557430120941, -0.775021790828588, -0.706064765316941, -0.739640105417572, -0.452474774137110, -0.413024861284096, -0.183974807874408, -0.206160809383938, -0.130349967406995, -0.185308804437716, -0.0579579451442943, -0.187605329771079, -0.112194816753357, -0.202555441786153, -0.250314228601536, -0.390296201025069, -0.382526767909630, -0.611012848714109, -0.497960681249562, -0.702850016379845, -0.599271063585756, -0.718297279541890, -0.612049816303525, -0.687271037353392, -0.658893029861346, -0.662309703178708, -0.558536928460123, -0.390662771602055, -0.291393366212183, -0.116703976231652, -0.159891803922542, -0.174918149058909, -0.166370462218219, -0.212642317181249, -0.291906249492704, -0.361537021404491, -0.472561245381299, -0.411311696399622, -0.370981527246004, -0.236347661823726, -0.111000343287654, -0.0211662150612145, -0.0310388930913253, -0.0352739461569759, -0.196855762245515, -0.363537535763821, -0.654286271823644, -0.629826110408800, -0.856132492699262, -0.809054252813385, -0.866271251539076, -0.662670070857406, -0.692154314082812, -0.500275482143220, -0.461508882539306, -0.323492064730559, -0.391874642045277, -0.285014615623310, -0.462534861920331, -0.541864473567725, -0.678351541936075, -0.715018372106731, -0.689042549295812, -0.459852626335500, -0.423424770534492, -0.273343036512114, -0.461451726425483, -0.424373720993087, -0.655706411361250, -0.501341523474631, -0.332256764781692, -0.0996263851290218, -0.188059330510743, -0.141530588788657, -0.347348411073935, -0.456732358498439, -0.811496028966800, -0.927397376071548, -0.983711092163613, -0.803810147475945, -0.640756916840789, -0.395169344982379, -0.372846656756861, -0.366663024991724, -0.704723281522873, -0.785390691165510, -0.987580825921064, -0.924933729673981, -0.776838413579159, -0.502057265580934, -0.120843590955067, 0.202871395855402, 0.359045916781977, 0.201046376533667, -0.0347378872510866, -0.0148425445067020, -0.0819289595108043, 0.0101501334874904, 0.180661358475221, 0.149822475686708, 0.0553663990738655, -0.119350885239843, -0.156302255826633, 0.0342759669181397, -0.143999118812631, -0.328519983424899, -0.459343786556877, -0.617071877282647, -0.548516171266812, -0.577719366986944, -0.716503268166115, -0.892383943759902, -0.936882918385454, -1.12287734404287, -1.01362888400391, -1.08842961258781, -0.925074483989576, -0.747499528447622, -0.673297586911217, -0.532710621667829, -0.643275843677372, -0.684202572249064, -0.701122910972786, -0.861871036032494, -0.801603084634604, -0.926636402709688, -0.634383483988593, -0.631624967243739, -0.496668112892975, -0.458527386871621, -0.352945547893521, -0.323080976504039, -0.200712355023638, -0.248774710387959, -0.229891948497834, -0.216661863156886, -0.182525457273761, -0.214227543536162, -0.0991256817960841, -0.0156922987406514, -0.0926538119749384, -0.121813094024880, -0.194068866349992, -0.377425900028118, -0.408894598102876, -0.467744915923493, -0.485313604594975, -0.611306833130293, -0.615624915669739, -0.652398325605097, -0.569320684095524, -0.433850142406340, -0.293821508187116, -0.243228487408697, -0.253562440720456, -0.409672740412305, -0.605779783521525, -0.641450265682557, -0.782655949066706, -0.716067213414708, -0.592712737613187, -0.398034621503934, -0.293277269675129, 0.0296956828554060, 0.0667529994979064, 0.200357051607651, 0.0428227191681024]
    single_pend_elbow_torque = [0.0465278730579011, 0.0465380552880637, 0.0442954247120896, 0.000472975149278289, 0.00153678136945750, 0.0326722692445865, 0.0464113802837893, 0.0555465149274084, 0.00377402419110858, -0.0704289828298839, -0.150747966920380, -0.225133130278316, -0.302231095815677, -0.312480320416420, -0.343045396736893, -0.338796072654245, -0.389752466914582, -0.359915041555759, -0.344683354928061, -0.281205488963434, -0.295076617710309, -0.385581258049989, -0.473642892701535, -0.504025720304037, -0.512173550251158, -0.513283546253974, -0.533590382365295, -0.443096920497868, -0.437973146596798, -0.399282543537063, -0.366288419354248, -0.287771764540599, -0.266936209933595, -0.189643090555299, -0.204286310841471, -0.188250250825576, -0.305084361911710, -0.286919439862383, -0.406266638722623, -0.370831479433178, -0.436615839800159, -0.375735016990587, -0.405627046290110, -0.306670878945436, -0.369015869182233, -0.296563068641280, -0.410833981854775, -0.389306190669512, -0.504917551350159, -0.507904330989175, -0.581258565263191, -0.540906648282434, -0.579756061882555, -0.481375525087644, -0.515881532376717, -0.417499400794538, -0.452917386328025, -0.421301034714391, -0.506460322178108, -0.502351683929807, -0.541979832162810, -0.507874126497371, -0.526676984540614, -0.495850247382116, -0.499958520280153, -0.453488230000053, -0.431146606336390, -0.423737588152466, -0.433726973890417, -0.444010229012442, -0.494402468126161, -0.484082704039548, -0.469175475122306, -0.453618254417182, -0.448307105682221, -0.422670287005625, -0.405818765226350, -0.380281539249518, -0.316926412479431, -0.195656848135375, -0.0716886962501284, -0.0829051737053551, -0.242217968570902, -0.457902927374518, -0.596704027784363, -0.617634006705587, -0.676905884132963, -0.722151346641365, -0.751947602679700, -0.789497105348390, -0.759512408722687, -0.766256934903449, -0.738934408673862, -0.713692464705684, -0.570562367534892, -0.475376478360141, -0.354816683728463, -0.340290326509717, -0.340082669514493, -0.456286520897421, -0.509577448872295, -0.539758122709207, -0.527001158562076, -0.505714630154106, -0.469160250009912, -0.505009601726881, -0.471892741764486, -0.544510504102440, -0.505860102652157, -0.527492509808840, -0.484748655937172, -0.463272195276407, -0.398160314386367, -0.398162519528632, -0.320775539593496, -0.313636442194916, -0.270293656082116, -0.264084681666052, -0.236834740526672, -0.253436555237496, -0.190169282892895, -0.193113480299617, -0.125060650901034, -0.103676876832862, -0.0703170431989752, -0.0247183376221276, 0.000603486134050617, -0.0138728881765861, 0.0117574332183938, 0.0211669295573940, 0.0225567779556503, -0.0420494753995570, 0.00780083263497732, -0.0389878461390102, -0.0160464480467658, -0.0394020608321837, -0.0618441372039219, -0.111326998618472, -0.184292467670954, -0.214301124902569, -0.275901285183812, -0.185098780269307, -0.112869643267650, -0.0474599600616810, -0.0658322175577952, -0.114589139964770, -0.227249343251202, -0.234070980270558, -0.355677377327015, -0.351892514918821, -0.380968477328928, -0.336579343265619, -0.408532391337225, -0.342568224713420, -0.367474414263680, -0.262763159896602, -0.284078931694427, -0.209514919011598, -0.259137608542211, -0.206068397564926, -0.288075771878132, -0.292795308139181, -0.340181008583726, -0.320475028918824, -0.415071763689504, -0.371092335984169, -0.391492309666704, -0.323985443232933, -0.363770450114990, -0.343282087377636, -0.413842467202298, -0.345128455710578, -0.460212275399144, -0.406070545123130, -0.500187561092263, -0.484526231943269, -0.551332048083894, -0.532976280148466, -0.582016251672736, -0.532452459068512, -0.513688203823689, -0.414762038756407, -0.470355863070018, -0.446879758311849, -0.504835349850071, -0.493202688331211, -0.571122610678229, -0.651433829808723, -0.668345973301556, -0.602063527877169, -0.567683759202979, -0.527371343731815, -0.481998519104979, -0.466639348016503, -0.464409291417052, -0.477615493237538, -0.499911130110266, -0.518124049142369, -0.528117346403067, -0.511291090474789, -0.505842863666501, -0.478487054045578, -0.439690013047330, -0.358594596890641, -0.299905683350169, -0.355961834070039, -0.380448453780297, -0.475711801960392, -0.520731291913172, -0.569526515741778, -0.613705993551022, -0.741525154245102, -0.815736219962200, -0.960169015887149, -0.992094666926530, -1.01946156590655, -
                                0.881880896901979, -0.759783364973270, -0.601526741443226, -0.539945458400109, -0.520372230148579, -0.567928593614505, -0.558288394483986, -0.600832463320578, -0.592690772715426, -0.628292595802656, -0.607597965934565, -0.595227648551382, -0.579833901636277, -0.585400529333157, -0.619617982742323, -0.674928917673458, -0.675772081944977, -0.699335688012154, -0.634310446760265, -0.562097539874120, -0.502002120190701, -0.459354414268372, -0.369984459828012, -0.373742842622412, -0.321792573954812, -0.345099529673272, -0.296340293012862, -0.267530075722153, -0.201766169432970, -0.189859546277922, -0.118565080663728, -0.116193709217337, -0.0681707262860253, -0.0826818284918819, -0.0779459692752061, -0.0696396429948249, -0.0581241230312546, -0.0698109630511314, -0.0708956535890601, -0.100034758364870, -0.103877642193219, -0.123067057916443, -0.123451498354242, -0.206009803519578, -0.265486694015201, -0.311106438922614, -0.416127912784469, -0.424305671025279, -0.432446777441385, -0.350504513910493, -0.265604352515798, -0.247532312837939, -0.328257369818292, -0.398765575959507, -0.502616201684857, -0.516187119235004, -0.573759073207382, -0.556402690101091, -0.559953571730969, -0.532096542341971, -0.554533729391908, -0.482730726131270, -0.541677133936497, -0.437189354484966, -0.475131377295148, -0.417852555925885, -0.522437119803610, -0.493920824958082, -0.546554207264051, -0.530967325646610, -0.528543421106316, -0.428649328963674, -0.419667824158072, -0.371832830537801, -0.421272232552143, -0.369701123143582, -0.419557793817192, -0.379281383041785, -0.507695689973938, -0.480335488135181, -0.514611623953022, -0.459965916416291, -0.492192453870160, -0.405071694709410, -0.423703027673792, -0.423648549078188, -0.477259750290872, -0.483004628089463, -0.525930286643711, -0.511253408925202, -0.555462128539546, -0.555503655637098, -0.633484587430742, -0.598938777473470, -0.619458869919765, -0.632504390871564, -0.660661389299341, -0.595641748285601, -0.632265694336518, -0.522745023937837, -0.563726507918594, -0.545283932670969, -0.577708264378239, -0.614343600071188, -0.648021935757887, -0.634510347414434, -0.667679481910997, -0.629663354224310, -0.634372214603495, -0.563885721158056, -0.451202247482711, -0.454245577360878, -0.561818832852181, -0.665340879177082, -0.681041655839618, -0.660300977096130, -0.643667660940899, -0.703383570739788, -0.776748903894245, -0.913108995033695, -0.986796842995928, -1.06019574292541, -1.00223366453951, -0.916323241952250, -0.744192677352911, -0.691244689419662, -0.602707380687550, -0.626005517535452, -0.647132518697834, -0.742641885722333, -0.726128100400968, -0.734490197809728, -0.689471656200816, -0.611844696378930, -0.539842861561809, -0.535122974468952, -0.496012392735409, -0.599772739508487, -0.587870006482692, -0.655923075626575, -0.627559848376940, -0.667574260314774, -0.552037853624961, -0.547453530609446, -0.457624623651972, -0.468293972021834, -0.401254339549945, -0.425650715087974, -0.330351658283715, -0.396739524341459, -0.309009178302698, -0.331694900326793, -0.281160978289676, -0.231710540542135, -0.167693353466726, -0.147004999490311, -0.0999837747670443, -0.0981660955993988, -0.0572862910688259, -0.0836717200061264, -0.0499907348029858, -0.0806898689565249, -0.0827369556821266, -0.0500448768830895, -0.0475761746360834, -0.102619087246874, -0.154412270425234, -0.187550882417770, -0.279204922024351, -0.311910216733118, -0.355949598833653, -0.345876616706590, -0.286489202175968, -0.266991220049320, -0.316858609481837, -0.306346845649193, -0.361517782073877, -0.391964189433887, -0.505042395804281, -0.524608394727744, -0.518101681106104, -0.476687409563391, -0.485324700843789, -0.436283992672428, -0.448794571667465, -0.377406018986362, -0.392970877616455, -0.332372820741055, -0.404118384915861, -0.326536268326860, -0.444739209020741, -0.404376126588405, -0.483832468067354, -0.423674866821249, -0.444136790007732, -0.358039762275996, -0.371171689030162, -0.358967105104087, -0.402904958552046, -0.373198145953349, -0.437190701567173, -0.384967547647283, -0.432724163818627, -0.391925217340517, -0.409106479972026, -0.368832362529879, -0.488389179200734, -0.483567841974233, -0.574361648879617, -0.509453265649360, -0.526388721949350, -0.531106061884375, -0.597757898831494, -0.557409104274613, -0.557831363506067, -0.512099235355386, -0.587545771501940, -0.600614271263216]

    if use_double_pendulum:
        elbow_torque = double_pend_elbow_torque
    else:
        elbow_torque = single_pend_elbow_torque

    motor_kv = 115
    torque_const = 8.27 / motor_kv

    input_current_plot = []
    output_current_plot = []
    output_pos_plot = []
    output_vel_plot = []
    t_plot = []

    initial_pos = driver_name.axis0.controller.input_pos
    plot_rate = 1/100
    plt.figure(figsize=(100, 25))
    plt.suptitle('Odrive Output', fontsize=75)
    plt.subplot(211)

    for i in range(len(elbow_torque)):
        try:
            t = i * plot_rate
            # elbow_torque[i] = -0.6
            input_current_plot.append(elbow_torque[i])
            t_plot.append(t)

            driver_name.axis0.controller.input_torque = elbow_torque[i]
            clear_errors(driver_name)

            output_pos, output_vel, output_current = get_motor_state(
                driver_name)
            # print("Moving to {} [turn]".format(output_pos))
            # print("Moving at {} [turn/s]".format(output_vel))
            print("Motor current is {} [A]".format(output_current))
            # print("The torque error is {} [N/m]".format(elbow_torque[i] + output_current * torque_const))

            output_pos_plot.append(output_pos - initial_pos)
            output_vel_plot.append(output_vel)
            output_current_plot.append(-output_current * torque_const)

            plt.scatter(t, elbow_torque[i], c="blue")
            plt.scatter(t, -output_current * torque_const, c="red")
            time.sleep(plot_rate)

        except:
            print("Couldn't complete motion. shutting down")
            shut_down(driver_name)
            raise

    plt.plot(t_plot, input_current_plot, c="blue", label="Input torque")
    plt.plot(t_plot, output_current_plot, c="red", label="Output torque")
    plt.ylabel('Torque [Nm]', fontsize=50)
    plt.xlabel('Time [sec]', fontsize=50)
    plt.grid()
    plt.title('Input & Output torque', fontsize=20)
    plt.legend(fontsize=50)

    plt.subplot(212)
    plt.plot(t_plot, output_pos_plot, c="blue", label="Output position")
    plt.plot(t_plot, output_vel_plot, c="red", label="Output velocity")
    plt.plot(t_plot, output_current_plot, c="green", label="Output torque")
    plt.xlabel('Time [sec]', fontsize=50)
    plt.grid()
    plt.title('Output Angle, Velocity & Torque', fontsize=20)
    plt.legend(fontsize=50)

    plt.savefig("output.png")


def main(args):
    use_double_pendulum = False

    # Find a connected ODrive (this will block until you connect one)
    print("Finding an ODrive...")
    odrv0 = odrive.find_any()

    # Find an ODrive that is connected on the serial port /dev/ttyUSB0
    # odrv0 = odrive.find_any("serial:/dev/ttyUSB0")

    if args["calibration"]:
        # Calibrate motor
        Calibration(odrv0)

    # Switching ti closed loop control state
    odrv0.axis0.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL
    odrv0.axis0.controller.config.input_mode = INPUT_MODE_PASSTHROUGH

    # To read a value, simply read the property
    print("The boards main supply voltage is {}V".format(str(odrv0.vbus_voltage)))

    # Moving to straight position
    # odrv0.axis0.controller.config.control_mode = CONTROL_MODE_POSITION_CONTROL
    # odrv0.axis0.controller.input_pos = STRAIGHT_POSITION
    # print("Initializing position")

    # Plotting position, velocity and current graph
    # liveplot(odrv0)

    if args["control"] == "position":
        driver_name = odrv0
        single_pend_elbow_position = [-0.004009052991377238, -0.021660280518908552, -0.03959156064402346, -0.05794028975702733, -0.07663312224946967, -0.09579102735558138, -0.11531022607339558, -0.13523161267311024, -0.15537947468638433, -0.175695574423249, -0.19597536589814293, -0.21626684012649627, -0.23652388950754058, -0.25689272613312375, -0.2772449382614437, -0.2975947070358066, -0.3178090585878779, -0.3379791210756349, -0.35796364949483683, -0.3779206005832766, -0.3978133437152476, -0.4177617793245688, -0.4376893166744268, -0.4574960456317758, -0.4769681488189587, -0.4959820197316463, -0.514421983353097, -0.5322576910891439, -0.5493332840335271, -0.5656476845698781, -0.5809999849733133, -0.5952824553663669, -0.6084024519049851, -0.6203487924346386, -0.6311138896899895, -0.6407667257073115, -0.6492941775583966, -0.6566830303291824, -0.6628960417307889, -0.6679450896127179, -0.6716921666163645, -0.6741913967061521, -0.6752712654196052, -0.6748510921274109, -0.6728945918677066, -0.6693362820878113, -0.6641148580547712, -0.6568871339448332, -0.6475585408819821, -0.636151508260449, -0.6231164403841655, -0.6087978743727208, -0.5934491251560303, -0.5771806063561521, -0.5602780446842297, -0.5429880308414567, -0.5254961927832559, -0.5079741053893079, -0.4906708726264283, -0.47361909062931024, -0.4568460721017116, -0.44018082045244317, -0.42357967350719455, -0.4068407665489619, -0.38991767746177397, -0.3729087332726034, -0.35593838544286627, -0.3391074987896688, -0.32259158270055416, -0.30635292113844387, -0.2904361283361744, -0.2747368481532249, -0.2594327273227713, -0.24449209818816087, -0.23020450919451546, -0.21666569688101794, -0.20412813319791176, -0.1924592491220189, -0.18167261593546466, -0.17169175763085132, -0.16243887401143522, -0.1538997457878849, -0.14600653057483215, -0.13864402477017196, -0.13181673199264068, -0.12530862678715002, -0.11911871668889444, -0.11298579808617738, -0.1067075613921039, -0.10009890308312179, -0.09309356941426468, -0.08556737854910186, -0.0775489503180167, -0.06907439729523046, -0.06028046769681495, -0.051199359067642204, -0.04179328885672447, -0.03206692450258297, -0.02203720213864204, -0.011866820653872122, -0.001772927598123705, 0.008012239541199674, 0.017270823536837378, 0.02577980166896012, 0.03347683811736257, 0.04025450578143752, 0.046091275458604, 0.050838488434075, 0.05454294397419044, 0.05722128270797521, 0.05900883508924703, 0.059861722460152235, 0.05955799692923491, 0.05788533722365526, 0.05477294093001966, 0.050208346311093534, 0.04420168675763328, 0.03672353362411985, 0.028013125429563503, 0.01811330770318554, 0.00715159273293574, -0.004753121444379381, -0.017369618075971427, -0.030599584331297718, -0.04420790665819606, -0.05817497585343206, -0.07240690102034536, -0.08712343349306252, -0.1022231578733147, -0.11792882318414688, -0.1340946488347545, -0.1508125033192573, -0.16787213514158256, -0.18527644719428416, -0.2027215881014714, -0.2202850137862121, -0.23772459419374128, -0.25524076154104464, -0.27271269496435263, -0.29034476645658314, -0.308074770453619, -0.3260070737316671, -0.3439763897663496, -0.3620048492939076, -0.3797894445833485, -0.3973425067077198, -0.41436264747985424, -0.4308671224955661, -0.4467167199259063, -0.46205154591322306, -0.4768029155602912, -0.4910081971298016, -0.5045324709558371, -0.5173686696565003, -0.5293948768095044, -0.5405748380866371, -0.5507555664508114, -0.5598445720610482, -0.5677885363744489, -0.574579420017013, -0.5802140250503646, -0.5847883796140515, -0.5882586173886661, -0.5905736956411202, -0.5916848496834134, -0.5915715793018972, -0.5901693008782922, -0.587438440015467, -0.58332322329699, -0.5776827437541731, -0.5702435211822467, -0.5607309609098657, -0.5491973243801339, -0.5360533903239141, -0.5218508898464919, -0.5069652063555877, -0.49149634232667094, -0.4756380879094909, -0.45955352567007335, -0.4433709887500043, -0.4272385020842044, -0.41114477925324244, -0.3951659055435327, -0.3792974788255755, -0.363540020509833, -0.347614481821168, -0.331355462763562, -0.31453840513129283, -0.29719184194717485, -0.27938079375765296, -0.26144877109610926, -0.24359229277601288, -0.2259539148580829, -0.20857441407280233, -0.19147378338992913, -0.17463505643306512, -0.1582120926551924, -0.14219437845977437, -0.12682064829656345, -0.11206430889940489, -0.09803924281308093, -0.08470427716697798, -0.07206578148615714, -0.060023905248026505, -0.04863041336515005, -0.037751155635107704, -0.02741593847194364, -0.017566632075931267, -0.008230947642154474, 0.0006152826583366048, 0.008894342299883097, 0.01671991898368049, 0.024051020798863964, 0.031016878835101878, 0.03763809107920723, 0.04396515980007819, 0.05007903073832215, 0.056013780280487376, 0.061709991845622814, 0.06720409768900286, 0.07249505118374215, 0.07756362501835555, 0.08223493360673119, 0.08660642549840342, 0.09054802030855953, 0.09409622551544902, 0.09717952836367319, 0.09973019705248806, 0.10161828262477914, 0.10266033190128701, 0.10277746720223932, 0.1018193553522495, 0.1000008409807234, 0.09749711905786504, 0.09447073047533047, 0.09088834370936619, 0.08664671498802368, 0.08149334248709016, 0.07542940597262054, 0.0681876312316854, 0.05980182766465878, 0.05023271915085455, 0.039619945862950035, 0.027832133568991814, 0.01506925900567981, 0.001320658206823524, -0.013112945229454873, -0.028225620706293888, -0.04378125958481077, -0.05983546433082253, -0.0761985288567394, -0.09299905811755153, -0.11018117977361991, -0.12778849165219688, -0.1457040441868727, -0.16408033885467263, -0.1827401758517463, -0.20165734463169135, -0.22059625910731373, -0.23957498251380802, -0.2584688569230083, -0.2773692951470871, -0.29603813164167436, -0.31467339624737556, -0.3330731399284031, -0.3513875338383104, -0.36950778359031267, -0.3875214360367712, -0.40531530921854525, -0.42293693170771357, -0.4402013427773411, -0.45699777586607876, -0.4730272245427687, -0.48835934799960273, -0.5028796196828721, -0.5166696251669352, -0.5296493075118224, -0.5419539943433143, -0.5537279418092669, -0.5649677902537736, -0.575475072671873, -0.5851291263394771, -0.5937980221834971, -0.6013409991938476, -0.607692033474019, -0.6128202198675794, -0.616735408256462, -0.6194732048501107, -0.621063659773191, -0.6215213044534348, -0.6208009215974287, -0.6188880629294959, -0.6157202651837478, -0.6112119237702697, -0.6051813458727247, -0.5975045037012069, -0.5883346566211982, -0.5777558750703714, -0.5660253006855196, -0.5532859680041908, -0.5396941083813596, -0.5253988354805279, -0.5107509547917953, -0.49597703835100143, -0.4814718621298088, -0.4673642960233297, -0.45377184773900164, -0.44041982067860147, -0.42706870010874326, -0.4133926651633923, -0.399295453563452, -0.38478194380375913, -0.3700181038416896, -0.3550361717144541, -0.33999341543728195, -0.32492807387008105, -0.3099826725561529, -0.2951666371272791, -0.2805089613637614, -0.26603124090899183, -0.25180441269263476, -0.2379668854557827, -0.2247063158497775, -0.21207985200800378, -0.20019639456433888, -0.18895238440320766, -0.1782243643298861, -0.16791514687332554, -0.157966930285614, -0.14820950614503506, -0.13869211303440535, -0.12933117433510305, -0.12022065477733204, -0.11128303998579832, -0.10248714652590506, -0.09371349631360273, -0.08496978229957734, -0.07612281042002424, -0.06720273351188157, -0.05813189869338455, -0.04898126653004342, -0.03977679678663049, -0.030536329504081777, -0.02127033247900939, -0.012044455760539967, -0.0028993236972432055, 0.006058070209530654, 0.01478104579874761, 0.02318730134411447, 0.031240092932417775, 0.03870912013407082, 0.045420274377507446, 0.05123471167030694, 0.05587584551167716, 0.05930042566483017, 0.06147010821573286, 0.06256516085611949, 0.06277801353725578, 0.06214703127379651, 0.06047991510505867, 0.0576120533973415, 0.05330401708701052, 0.04753538571844053, 0.0401873071831025, 0.03132460692641207, 0.020969021715791427, 0.009222994878919845, -0.003924153274265841, -0.018253906289984696, -0.033852037498990135, -0.05041190814287088, -0.06795943616796353, -0.08629082674965652, -0.10558212626861878, -0.12569063181738815, -0.14666227106176694, -0.16837802877734168, -0.19074680386991033, -0.21344361083268787, -0.23635673899602544, -0.2592814156531521, -0.28224312270135193, -0.30502827128595883, -0.3276641993386163, -0.3499658039445863, -0.37214922548982393, -0.3940631780707293, -0.41570368904233634, -0.4368576792949847, -0.4575198580184943, -0.4774045094300108, -0.4964792816551922, -0.514671123564889, -0.5320379144085065, -0.5485278946791406, -0.5641810623591634, -0.5789045216728488, -0.5927485010080713, -0.6056622277030808, -0.6177832325745644, -0.6289857882557983, -0.6392777910358144, -0.6486528120105116, -0.6571435608853499, -0.6645650546878219, -0.6709764348222477, -0.6760939218431085, -0.6799940158053662, -0.6826165512709301, -0.6840259394953088, -0.684300686872249, -0.6835161661744272, -0.6816394622166888, -0.6787517282314899, -0.6747687974277029, -0.6697110589238223, -0.663424121460843, -0.655657031422541, -0.6464373042206378, -0.6360452478499417, -0.6247564754681735, -0.6126424293310835, -0.5996913872153, -0.5859044459074687, -0.5714669361844477, -0.5565998054582744, -0.5416760621197595, -0.5269220590134354, -0.5125641427545268, -0.49851702784225443, -0.4846281853372712, -0.47053992315977605, -0.45617698343789104, -0.4413808133787107, -0.4262594422424229, -0.4109177331124401, -0.3956385351841063, -0.38044027121012425, -0.3654005022884864, -0.35047026695279987, -0.3355230224183276, -0.32044547436502574, -0.30528425698666095, -0.29000526279967975, -0.274913801340637, -0.2600416535019508, -0.24560973503297415, -0.23160970950215143, -0.21819386618387343, -0.2051441121199211, -0.19250330079824293, -0.18011082973670406, -0.16804290515047893, -0.15619058098752095, -0.14466053524288205, -0.13327483290353495, -0.12223773268370741, -0.11138751817549701, -0.1008229559654045, -0.09046848226374793, -0.08024998881618563, -0.07005801132240569, -0.05988531569732861, -0.0496621494843016, -0.03942590384416825, -0.02912157301817313, -0.018853734749686973, -0.008584825648750904, 0.0015701879366806766, 0.011564270739116003, 0.02143322990839489, 0.031141864530412646, 0.040519112941559306, 0.04940228655365487, 0.05767430532097272, 0.06508137124211061, 0.07151199606095543, 0.07683137642816407, 0.08103704314043399, 0.08424803161755415, 0.08649335489532108, 0.08764161477124993, 0.08770854788982112, 0.08655862616935919, 0.08411937702654328, 0.08012735999211705, 0.07454616156437768, 0.06740755543648717, 0.05883260800681693, 0.04883008913437594,
                                      0.03755144680908926, 0.025008045295278298, 0.011415460531530513, -0.0032117137451260283, -0.01867394995855468, -0.0350812930013687, -0.05218625452051429, -0.07020175653295208, -0.08896188445746611, -0.10858118713180132, -0.1288401883255747, -0.14970720736996, -0.17089544158983197, -0.19235114023299277, -0.21395943756087535, -0.23573783555761174, -0.25752894883602157, -0.27939731252836825, -0.30113227976663043, -0.3227604811218131, -0.3440996172194887, -0.36510587079651124, -0.3856009058731241, -0.405787307697986, -0.42557531197509185, -0.44510370391430604, -0.4641441977315171, -0.4826642135137878, -0.5006046646195069, -0.5180558922553331, -0.5348572454880653, -0.5509471356514571, -0.5661574424294507, -0.5806104816622625, -0.5942842553193246, -0.6072322137398172, -0.6192916476688558, -0.6304247135031951, -0.6404168212052703, -0.649301128753071, -0.6570324374473867, -0.6636041926843288, -0.6688932827653582, -0.6728851175403241, -0.675455749376101, -0.6766983634776782, -0.6766605199854685, -0.6753328246991706, -0.672574220533739, -0.6680155390290501, -0.661401852894565, -0.6527290488548149, -0.6424479612169794, -0.6309950252882218, -0.6186395534639815, -0.6056128279307077, -0.5920908918602237, -0.5782189394120866, -0.5642134208157634, -0.5500890004197028, -0.5358976227963592, -0.5215188765651243, -0.5068546840386406, -0.4918067906754993, -0.4763281750491219, -0.46023127572049966, -0.44357910905936715, -0.42637373820072916, -0.4089048520182328, -0.391177297301317, -0.3734133427901665, -0.3554969989395599, -0.33751861032861985, -0.3194213435108635, -0.3013974465419669, -0.2834524297239955, -0.26574101997895444, -0.248434488688553, -0.23160274840974868, -0.2152570972876709, -0.19941335669347254, -0.18389691326128263, -0.16877394358657727, -0.15388627190292745, -0.13932405350622623, -0.12494619381341741, -0.1107922715807316, -0.09682893486612648, -0.0832301478140474, -0.06999607228801141, -0.057187564568454384, -0.044692971875998695, -0.03248533730034854, -0.020537545280997653, -0.008871948457614545, 0.0026498276695343676, 0.014035380868554298, 0.025357895467900855, 0.036465039392363244, 0.047355874935383825, 0.057869820444835005, 0.06798924659800244, 0.0776655290238489, 0.08676935106092373, 0.09524083124745898, 0.10294686466492678, 0.10980134843753005, 0.11558833575279485, 0.12024025415102135, 0.12359729612482322, 0.1255443654992991, 0.12618205753148268, 0.12559294447375385, 0.1237636782642745, 0.12086633333351568, 0.1168713141269694, 0.11183041912504195, 0.10545775085997791, 0.09752426723010282, 0.08787328169637812, 0.07664115670894907, 0.06384992312821727, 0.049666043894034534, 0.0340850062104677, 0.01732370253402352, -0.00042832197187077825, -0.018932600229958428, -0.038081146171022505, -0.05766753289978527, -0.07770376618360236, -0.09818931244410574, -0.11934153330430439, -0.14116567037648756, -0.16375693796572846, -0.18683093945854937, -0.21023522249899365, -0.23366143854953667, -0.2570668923860136, -0.280276057592374, -0.3033422046761036, -0.3261310580223998, -0.34869874575953963, -0.3708677339100732, -0.392656301670405, -0.41386090960984484, -0.4345106043064239, -0.4543494195860855, -0.4734442466639164, -0.49184001173032255, -0.5094739810490045, -0.5263442898718654, -0.5424037265751391, -0.5575479793208552, -0.5718096304287165, -0.5850509927962981, -0.5972708253092762, -0.6084151620350706, -0.6188497859846497, -0.6284796768724585, -0.637295323254808, -0.645013454350201, -0.6515813363400805, -0.6569416905091054, -0.6610243265579736, -0.6638437421831666, -0.665340434892804, -0.6656040445394055, -0.664753157625625, -0.6628650340549782, -0.6599382105737331, -0.6558791843251078, -0.6505976490305969, -0.6439724248245435, -0.6357730180818056, -0.6258136373369907, -0.6141623874911902, -0.6011423383368966, -0.5871180867343876, -0.572330802683237, -0.5567721903740543, -0.5407017695110721, -0.5242438426709917, -0.5076501210328342, -0.49109524245596714, -0.47478158790678254, -0.45873604487318864, -0.44297375072731204, -0.4273543239310891, -0.4117485741239075, -0.3957941470129053, -0.3794783975589308, -0.3626658797381016, -0.34554631535327396, -0.32816396340121134, -0.3107183146164492, -0.2932122518771018, -0.2757386344565461, -0.25836288939845536, -0.2411819784953997, -0.22425081310926356, -0.2078014780238131, -0.19194092106457666, -0.17695009477567614, -0.16286918538019265, -0.14978792911894478, -0.13752888959055184, -0.12593870064661872, -0.11479636881742575, -0.10410259593311262, -0.09366835711659466, -0.08356671487517744, -0.07372611835949383, -0.06410155649362292, -0.05466499767690666, -0.04531234681734709, -0.03602825607395858, -0.02687475548673273, -0.017778976143623185, -0.008708603196549093, 0.0004436647080284786, 0.009712142197443109, 0.01921637491674026, 0.028820868112382395, 0.03853107426086622, 0.04820959111997894, 0.057726504223116995, 0.06696593197968805, 0.07583196051121938, 0.0841629570420087, 0.09184557751745816, 0.09863357570310562, 0.10428166603337574, 0.10869007278003692, 0.11172132338132215, 0.11336913804202144, 0.113470082368397, 0.11200855935165113, 0.10884581877414298, 0.10415693665950759, 0.09789763637675344, 0.09010300734554871, 0.08071137462821446, 0.06987305822901614, 0.05749545522952525, 0.04369835664204632, 0.028550779031932864, 0.012193205937224554, -0.005243663660990418, -0.023542312724472016, -0.04258392732939059, -0.06209499822841899, -0.08220807152108013, -0.10280457891632576, -0.12403500990576934, -0.14579659298187983, -0.1679333986833889, -0.19018434807743467, -0.212537370513572, -0.23476615739818302, -0.25702098777081317, -0.27908465509697344, -0.3010328255005871, -0.3226940493211952, -0.34402224044911783, -0.36486637855167986, -0.38512780987545453, -0.40466404057891936, -0.42351495058580696, -0.4417786207454606, -0.45941577043646475, -0.476307820406005, -0.49257073228606213, -0.5079984589837103, -0.5225911319822184, -0.5363125591637546, -0.5491844869790066, -0.5611696718608037, -0.5723747767145363, -0.5827108435582192, -0.5922832143173734, -0.6009687139201806, -0.6087139356047532, -0.6154305660414806, -0.6211985985096473, -0.6259326362798754, -0.6297672128962181, -0.6326580398949898, -0.6347105804695128, -0.6357609858383105, -0.635851850551563, -0.6349969984146705, -0.633255894708381, -0.6307012904789459, -0.6272927562380687, -0.6229569146715842, -0.6175131960619755, -0.6106166000826856, -0.6021767382857485, -0.5924984591318105, -0.5819616382679095, -0.5708479282318918, -0.5593248030536326, -0.5475855616596123, -0.5357754956914227, -0.52403577375085, -0.5123643302445927, -0.5008967176022578, -0.4895530418070205, -0.47843300445372766, -0.4672904361101815, -0.45611406514157415, -0.44451813593776685, -0.4324442710966015, -0.4196766358873923, -0.4062699197472391, -0.3922188437799386, -0.3777697126806798, -0.36286968268059805, -0.34763041542771567, -0.3318762996940919, -0.3157667399015494, -0.2993236346420375, -0.2827730559460676, -0.26613022329041863, -0.24967223444408088, -0.23343848168132733, -0.21754770205933685, -0.20191087033156052, -0.18663169041405436, -0.17161391629675782, -0.15695796213873417, -0.1426551271817433, -0.12882098694886354, -0.11548522567216978, -0.10279295623404396, -0.09061218611491448, -0.07896425656862471, -0.06766221391519876, -0.05668841173498818, -0.04579690013496016, -0.035031901716840154, -0.024333371280884586, -0.013747705908444874, -0.0031481062881372097, 0.007389042361172605, 0.017980569607988023, 0.028509426160190737, 0.03894659107095814, 0.04921060764481318, 0.0591771531274173, 0.0688424520941939, 0.0780661055448655, 0.08671567432612573, 0.09466154201141538, 0.10170812927435245, 0.10769150876373339, 0.11240979012783164, 0.11581091608160196, 0.11799083410982317, 0.11905132656298253, 0.11907828983375725, 0.11797072928733149, 0.11554910185699181, 0.11161337694007509, 0.10619352395898803, 0.0991752174076241, 0.09063015686568417, 0.08050970600470311, 0.06912018297522526, 0.05650519223288281, 0.042866475562266367, 0.028191281235239417, 0.01266688337665762, -0.0037265814478407203, -0.020741649113280882, -0.03851105583944567, -0.056811126875307, -0.07579539758662487, -0.09531985547209357, -0.11560064232929859, -0.13630261377972594, -0.15750960794526858, -0.179020428859866, -0.20084783771211182, -0.22278678319907003, -0.24478694602395576, -0.26664423499937107, -0.28837291471679377, -0.3097711235954938, -0.33110117345819706, -0.35225982241155884, -0.3733421005699643, -0.3942047539896194, -0.414776516814288, -0.4348292270634099, -0.4543326096888512, -0.47304067358827295, -0.4910730218722067, -0.5083983084999637, -0.52515915584005, -0.5413034736696438, -0.5569045126206319, -0.5718659648284053, -0.5860179081607234, -0.599194921057907, -0.6111867261232174, -0.6218148478370391, -0.6310233629798072, -0.6387003655661156, -0.6449702730044057, -0.6499395963928603, -0.6537395621723482, -0.6561525425528728, -0.6571090821226906, -0.6564168901239054, -0.6540696791109215, -0.6500519959307653, -0.6443117051488839, -0.6368334301830476, -0.6274965792464582, -0.6162345466624288, -0.6030569284682973, -0.588380774095801, -0.5724675199482065, -0.5555073187895523, -0.5376550894469887, -0.5193309546123202, -0.5007597014091871, -0.48234456877284926, -0.4641580599761643, -0.446269240456718, -0.42857501641760426, -0.4110037310971541, -0.39349712135502046, -0.3760469871385727, -0.35861839517204025, -0.34135568930281707, -0.3242548202162766, -0.30748294905685875, -0.2910140105679194, -0.27487389694079944, -0.2589581444406421, -0.24335120110661784, -0.2279743011219743, -0.21293272780137482, -0.1981401751451947, -0.1837937115358235, -0.16993532152902543, -0.1567818416991502, -0.1442476378181884, -0.1323385762775737, -0.12087973924425148, -0.10982305876304256, -0.09905936871530956, -0.0885395772409814, -0.07818340109941414, -0.06811896232392639, -0.05828308744804422, -0.04878610400259234, -0.03950075448451784, -0.03052321080896068, -0.021740594252848317, -0.013143842503091698, -0.004730381139065432, 0.003497290427062338, 0.011623186162824184, 0.019621974613267312, 0.0275314432378925, 0.03536312004366809, 0.04311101128347149, 0.05070621444753279, 0.05807381910792649, 0.06517014223472757, 0.0718961366330106, 0.07825466272887947, 0.08407409745732027, 0.08928097675217, 0.09359377806976746, 0.09673442219800904, 0.09839713014674804, 0.09840933302726462, 0.0967398627301828, 0.09375810729866343, 0.08955902787105653, 0.08429970643144738, 0.078068219664741, 0.07098155727353803, 0.06296677907754088, 0.05390144376826422, 0.04359509015860439, 0.03207731524859755, 0.01918191761047947, 0.00502427220889839]

        if use_double_pendulum:
            elbow_position = double_pend_elbow_position
        else:
            elbow_position = single_pend_elbow_position

        position_control(odrv0, use_double_pendulum)

        # driver_name.axis0.controller.config.control_mode = CONTROL_MODE_TORQUE_CONTROL

        # # class InstantUpdateControl(UpdateControl):
        # #     def ApplyUpdate(self):
        # #         self.state += self.correction

        # motor_kv = 115
        # torque_const = 8.27 / motor_kv

        # input_current_plot = []
        # output_current_plot = []
        # output_pos_plot = []
        # output_vel_plot = []
        # t_plot = []

        # plot_rate = 1/100
        # plt.figure(figsize=(100, 25))
        # plt.suptitle('Odrive Output', fontsize=75)
        # plt.subplot(211)

        # # Initializing controller
        # # pid = PID(1.0, 1.0, 1.0, time())
        # SetPoint = -0.4
        # pid = PID(1, 10, 0.001, SetPoint=SetPoint, dt=plot_rate/10)

        # # model = InstantControl()

        # for i in range(len(elbow_position)):
        #     try:
        #         # model.SetTargetState(elbow_position[i])
        #         # model.SetTargetState(0.4)

        #         t = i * plot_rate
        #         input_current_plot.append(0.4)
        #         t_plot.append(t)

        #         state = 0
        #         state=pid.compute(state)
        #         output_pos, output_vel, output_current = get_motor_state(driver_name)

        #         for i in range(10):
        #             # correction = pid.Update(model.GetError(), time())
        #             # model.SetCorrection(correction)

        #             # state = model.GetState()
        #             state=pid.compute(output_current * torque_const)
        #             driver_name.axis0.controller.input_torque = state
        #             clear_errors(driver_name)
        #             output_pos, output_vel, output_current = get_motor_state(driver_name)
        #             print("The torque error is {} [N/m]".format(state - output_current * torque_const))

        #             output_pos_plot.append(output_pos + 160)
        #             output_vel_plot.append(output_vel)
        #             output_current_plot.append(-output_current * torque_const)

        #             # plt.scatter(t, elbow_torque[i], c="blue")
        #             plt.scatter(t, state, c="blue")
        #             plt.scatter(t, -output_current * torque_const, c="red")
        #             # time.sleep(plot_rate)

        #             # time.sleep(plot_rate / 10)

        #         # driver_name.axis0.controller.input_torque = elbow_torque[i]
        #         clear_errors(driver_name)

        #         # output_pos, output_vel, output_current = get_motor_state(driver_name)
        #         # # print("Moving to {} [turn]".format(output_pos))
        #         # # print("Moving at {} [turn/s]".format(output_vel))
        #         # # print("Motor current is {} [A]".format(output_current))
        #         # # print("The torque error is {} [N/m]".format(elbow_torque[i] - output_current * torque_const))
        #         # print("The torque error is {} [N/m]".format(state - output_current * torque_const))

        #         # output_pos_plot.append(output_pos + 160)
        #         # output_vel_plot.append(output_vel)
        #         # output_current_plot.append(-output_current * torque_const)

        #         # # plt.scatter(t, elbow_torque[i], c="blue")
        #         # plt.scatter(t, state, c="blue")
        #         # plt.scatter(t, -output_current * torque_const, c="red")
        #         time.sleep(plot_rate)

        #     except:
        #         print("Couldn't complete motion. shutting down")
        #         shut_down(driver_name)
        #         raise

        # plt.plot(t_plot, input_current_plot, c="blue", label="Input torque")
        # plt.plot(t_plot, output_current_plot, c="red", label="Output torque")
        # plt.ylabel('Torque [Nm]', fontsize=50)
        # plt.xlabel('Time [sec]', fontsize=50)
        # plt.grid()
        # plt.title('Input & Output torque', fontsize=20)
        # plt.legend(fontsize=50)

        # plt.subplot(212)
        # plt.plot(t_plot, output_pos_plot, c="blue", label="Output position")
        # plt.plot(t_plot, output_vel_plot, c="red", label="Output velocity")
        # plt.plot(t_plot, output_current_plot, c="green", label="Output torque")
        # plt.xlabel('Time [sec]', fontsize=50)
        # plt.grid()
        # plt.title('Output Angle, Velocity & Torque', fontsize=20)
        # plt.legend(fontsize=50)

        # plt.savefig("output.png")

    elif args["control"] == "velocity":
        velocity_control(odrv0, use_double_pendulum)

    elif args["control"] == "current":
        current_control(odrv0, use_double_pendulum)

    else:
        print("Control mode is invalid")

    print("Finished motion. shutting down")
    # shut_down(odrv0)


if __name__ == '__main__':
    # construct the argument parse and parse the arguments
    parser = argparse.ArgumentParser()
    parser.add_argument("--calibration", default=False, help="calibrate motor")
    parser.add_argument(
        "--control", help="control mode: current, position, or velocity")
    args = vars(parser.parse_args())
    main(args)
